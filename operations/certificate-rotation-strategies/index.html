
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://vault.axonshield.com/operations/certificate-rotation-strategies/">
      
      
        <link rel="prev" href="../certificate-lifecycle-management/">
      
      
        <link rel="next" href="../inventory-and-discovery/">
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Certificate Rotation Strategies - Shield Vault</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
    
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WJXPDRF2');</script>
  <!-- End Google Tag Manager -->
  
  <!-- Apollo Tracking -->
  <script>
    (function() {
      var apolloScript = document.createElement('script');
      apolloScript.type = 'text/javascript';
      apolloScript.async = true;
      apolloScript.src = 'https://cdn.apollo.io/v1/apollo.js';
      apolloScript.setAttribute('data-apollo-id', '68b8b91c5e883f0021f7f7aa');
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(apolloScript, s);
    })();
  </script>
  <!-- End Apollo Tracking -->
  
  <!-- Organization Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "Axon Shield",
    "url": "https://vault.axonshield.com",
    "logo": "https://vault.axonshield.com/logo.png",
    "description": "Enterprise PKI and certificate automation consulting. Cambridge postdoctoral expertise with implementations at Barclays, Deutsche Bank, Sky UK, and Comcast. Specializing in HSM integration, multi-tenant PKI architecture, and certificate management for fintech and healthcare.",
    "priceRange": "$$$",
    "areaServed": {
      "@type": "Country",
      "name": "Worldwide"
    },
    "serviceType": [
      "PKI Architecture Consulting",
      "Certificate Automation Implementation", 
      "HSM Integration",
      "Multi-Tenant PKI Design",
      "Certificate Management Strategy",
      "Post-Quantum Cryptography Planning"
    ],
    "founder": {
      "@type": "Person",
      "name": "Dan Cvrcek",
      "jobTitle": "Founder and Principal Consultant",
      "description": "Cambridge postdoctoral researcher specializing in PKI and cryptography. Black Hat and DEF CON conference speaker with 20+ years implementing certificate infrastructure for Fortune 500 companies.",
      "alumniOf": {
        "@type": "CollegeOrUniversity",
        "name": "University of Cambridge",
        "sameAs": "https://www.cam.ac.uk"
      },
      "honorificPrefix": "Dr.",
      "knowsAbout": [
        {
          "@type": "Thing",
          "name": "Public Key Infrastructure",
          "sameAs": "https://en.wikipedia.org/wiki/Public_key_infrastructure"
        },
        {
          "@type": "Thing", 
          "name": "Hardware Security Module",
          "sameAs": "https://en.wikipedia.org/wiki/Hardware_security_module"
        },
        {
          "@type": "Thing",
          "name": "Certificate Automation"
        },
        {
          "@type": "Thing",
          "name": "PKCS#11"
        },
        {
          "@type": "Thing",
          "name": "Zero Trust Architecture"
        },
        {
          "@type": "Thing",
          "name": "Operational Models"
        }
      ],
      "award": [
        "Black Hat USA Conference Speaker",
        "DEF CON Conference Speaker"
      ],
      "workExample": [
        {
          "@type": "Organization",
          "name": "Barclays",
          "sameAs": "https://en.wikipedia.org/wiki/Barclays"
        },
        {
          "@type": "Organization",
          "name": "Deutsche Bank",
          "sameAs": "https://en.wikipedia.org/wiki/Deutsche_Bank"
        },
        {
          "@type": "Organization",
          "name": "Sky UK",
          "sameAs": "https://en.wikipedia.org/wiki/Sky_UK"
        },
        {
          "@type": "Organization",
          "name": "TSB Bank PLC (part of Banco Sabadell)",
          "sameAs": "https://en.wikipedia.org/wiki/TSB"
        },
        {
          "@type": "Organization",
          "name": "Comcast",
          "sameAs": "https://en.wikipedia.org/wiki/Comcast"
        }
      ],
      "hasCredential": [
        {
          "@type": "EducationalOccupationalCredential",
          "credentialCategory": "Postdoctoral Research",
          "recognizedBy": {
            "@type": "CollegeOrUniversity",
            "name": "University of Cambridge"
          }
        },
        {
          "@type": "EducationalOccupationalCredential",
          "credentialCategory": "Professor (Docent)",
          "recognizedBy": {
            "@type": "CollegeOrUniversity",
            "name": "Brno University of Technology"
          }
        }
      ]
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Consulting Services",
      "itemListElement": [
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "PKI Architecture Assessment",
            "description": "Comprehensive evaluation of PKI readiness, architecture design, and implementation planning"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service", 
            "name": "HSM Integration Implementation",
            "description": "End-to-end HSM deployment including vendor selection, PKCS#11 integration, and operational procedures"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Certificate Automation Strategy",
            "description": "Multi-tenant PKI design, ACME implementation, and certificate lifecycle automation"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Infrastructure Intelligence - Operational Model",
            "description": "Integration with Asset Management, CMDB, Runbooks, Integrated Network Perimeter (WAF, DoS, DNS, PKI)"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "PKI Rescue Consulting",
            "description": "Emergency response for certificate outages, HSM failures, and PKI implementation problems"
          }
        }
      ]
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "5.0",
      "reviewCount": "12",
      "bestRating": "5"
    }
  }
  </script>
  <!-- End Organization Schema -->

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#certificate-rotation-strategies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Shield Vault" class="md-header__button md-logo" aria-label="Shield Vault" data-md-component="logo">
      
  <img src="../../assets/axon-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Shield Vault
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Certificate Rotation Strategies
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Why Certificate Management Matters

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quick-start/" class="md-tabs__link">
        
  
  
    
  
  Quick Start Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../technical-guide/" class="md-tabs__link">
        
  
  
    
  
  Foundations for Infrastructure Intelligence - Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/case-studies/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../business/cost_of_certificate_management/" class="md-tabs__link">
          
  
  
  Business

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../foundations/certificate-anatomy/" class="md-tabs__link">
          
  
  
  Foundations

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../implementation/acme-protocol-implementation/" class="md-tabs__link">
          
  
  
  Implementation

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../certificate-lifecycle-management/" class="md-tabs__link">
          
  
  
  Operations

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../patterns/ca-hierarchies/" class="md-tabs__link">
          
  
  
  Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../security/ca-compromise-scenarios/" class="md-tabs__link">
          
  
  
  Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../standards/acme-protocol/" class="md-tabs__link">
          
  
  
  Standards

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../strategy/success-metrics/" class="md-tabs__link">
          
  
  
  Strategy

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../troubleshooting/chain-validation-errors/" class="md-tabs__link">
          
  
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../vendors/digicert-certcentral/" class="md-tabs__link">
          
  
  
  Vendors

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Shield Vault" class="md-nav__button md-logo" aria-label="Shield Vault" data-md-component="logo">
      
  <img src="../../assets/axon-logo.png" alt="logo">

    </a>
    Shield Vault
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why Certificate Management Matters
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foundations for Infrastructure Intelligence - Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/case-studies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Case Studies - Certificate Management at Scale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/certificate-as-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate-as-Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/mutual-tls-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mutual TLS Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/service-mesh-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Mesh Certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/zero-trust-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zero-Trust Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Business
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Business
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../business/cost_of_certificate_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The $67 Million Risk: Hidden Costs of Manual Certificate Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Foundations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Foundations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../foundations/certificate-anatomy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Anatomy
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../foundations/cryptographic-primitives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cryptographic Primitives
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../foundations/public-private-key-pairs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Public-Private Key Pairs
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../foundations/trust-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Models
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../foundations/what-is-pki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    What is PKI?
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Implementation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/acme-protocol-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACME Protocol Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/ca-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CA Architecture
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/certificate-issuance-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Issuance Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/hsm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HSM Integration
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/hsm-operational-failures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HSM Operational Failures
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/multi-cloud-pki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Cloud PKI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../implementation/onprem-vs-cloud-hsm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Premises vs Cloud HSM
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate-lifecycle-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Lifecycle Management
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Certificate Rotation Strategies
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Certificate Rotation Strategies
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-certificate-rotation-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Certificate Rotation Matters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Certificate Rotation Matters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-cost-of-reactive-renewal" class="md-nav__link">
    <span class="md-ellipsis">
      The Cost of Reactive Renewal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-value-of-strategic-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      The Value of Strategic Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-timing-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Timing Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Timing Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-schedule-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Schedule Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validity-based-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Validity-Based Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absolute-time-window" class="md-nav__link">
    <span class="md-ellipsis">
      Absolute Time Window
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Driven Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hybrid-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Hybrid Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Workflows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#certificate-lifecycle-states" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Lifecycle States
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-to-end-rotation-process" class="md-nav__link">
    <span class="md-ellipsis">
      End-to-End Rotation Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-patterns-by-environment-type" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Patterns by Environment Type
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Patterns by Environment Type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-server-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Web Server Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-gateway-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      API Gateway Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Database Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mobile-app-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Mobile App Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-and-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      Automation and Orchestration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation and Orchestration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acme-protocol-automated-certificate-management" class="md-nav__link">
    <span class="md-ellipsis">
      ACME Protocol (Automated Certificate Management)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-as-code-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Infrastructure as Code Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback Procedures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rollback-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback Triggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Rollback Procedures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      Do's
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#donts" class="md-nav__link">
    <span class="md-ellipsis">
      Don'ts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-challenges-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Challenges and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Challenges and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#challenge-coordinating-multi-system-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Coordinating Multi-System Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-long-running-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Long-Running Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-third-party-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Third-Party Dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-certificate-pinning" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Certificate Pinning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measuring-rotation-success" class="md-nav__link">
    <span class="md-ellipsis">
      Measuring Rotation Success
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measuring Rotation Success">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Key Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-improvement" class="md-nav__link">
    <span class="md-ellipsis">
      Continuous Improvement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standards-and-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      Standards and Specifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#industry-frameworks-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Industry Frameworks and Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cryptography-and-certificate-management" class="md-nav__link">
    <span class="md-ellipsis">
      Cryptography and Certificate Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-tools-and-platforms" class="md-nav__link">
    <span class="md-ellipsis">
      Automation Tools and Platforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-and-configuration-management" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Configuration Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incident-response-and-operational-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response and Operational Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-studies-and-real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Case Studies and Real-World Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-research-and-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Security Research and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#books-and-comprehensive-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Books and Comprehensive Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standards-organizations-and-working-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Standards Organizations and Working Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inventory-and-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inventory and Discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring-and-alerting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring and Alerting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../renewal-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Renewal Automation
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/ca-hierarchies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CA Hierarchies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/cloud-vs-on-premises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud vs On-Premises
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/high-availability-disaster-recovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    High Availability and Disaster Recovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/multi-tenancy-considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Tenancy Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/ca-compromise-scenarios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CA Compromise Scenarios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/certificate-pinning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Pinning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/common-vulnerabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common Vulnerabilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/compliance-and-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compliance and Audit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/incident-response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incident Response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/key-management-best-practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Key Management Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/private-key-protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Private Key Protection
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/threat-models-and-attack-vectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Models and Attack Vectors
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Standards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Standards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/acme-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACME Protocol
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/ocsp-and-crl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OCSP and CRL
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/pkcs-standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PKCS Standards
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/tls-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TLS Protocol
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/x509-standard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X.509 Standard
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Strategy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Strategy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strategy/success-metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Success Metrics and KPIs for Certificate Automation
    
  </span>
  
    
  
  
    <span class="md-status md-status--stable"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/chain-validation-errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chain Validation Errors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/common-misconfigurations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common Misconfigurations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/expired-certificate-outages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expired Certificate Outages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/performance-bottlenecks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Bottlenecks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vendors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Vendors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vendors/digicert-certcentral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DigiCert CertCentral
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vendors/hashicorp-vault-pki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HashiCorp Vault PKI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vendors/keyfactor-command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Keyfactor Command
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vendors/venafi-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Venafi Platform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vendors/vendor-comparison-matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vendor Comparison Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-certificate-rotation-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Certificate Rotation Matters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Certificate Rotation Matters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-cost-of-reactive-renewal" class="md-nav__link">
    <span class="md-ellipsis">
      The Cost of Reactive Renewal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-value-of-strategic-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      The Value of Strategic Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-timing-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Timing Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Timing Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-schedule-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Schedule Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validity-based-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Validity-Based Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absolute-time-window" class="md-nav__link">
    <span class="md-ellipsis">
      Absolute Time Window
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Driven Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hybrid-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Hybrid Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Workflows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#certificate-lifecycle-states" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Lifecycle States
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-to-end-rotation-process" class="md-nav__link">
    <span class="md-ellipsis">
      End-to-End Rotation Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-patterns-by-environment-type" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation Patterns by Environment Type
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Patterns by Environment Type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-server-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Web Server Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-gateway-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      API Gateway Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Database Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mobile-app-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Mobile App Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-and-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      Automation and Orchestration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation and Orchestration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acme-protocol-automated-certificate-management" class="md-nav__link">
    <span class="md-ellipsis">
      ACME Protocol (Automated Certificate Management)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-as-code-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Infrastructure as Code Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback Procedures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rollback-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback Triggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Rollback Procedures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      Do's
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#donts" class="md-nav__link">
    <span class="md-ellipsis">
      Don'ts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-challenges-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Challenges and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Challenges and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#challenge-coordinating-multi-system-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Coordinating Multi-System Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-long-running-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Long-Running Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-third-party-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Third-Party Dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge-certificate-pinning" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: Certificate Pinning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measuring-rotation-success" class="md-nav__link">
    <span class="md-ellipsis">
      Measuring Rotation Success
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measuring Rotation Success">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Key Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-improvement" class="md-nav__link">
    <span class="md-ellipsis">
      Continuous Improvement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standards-and-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      Standards and Specifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#industry-frameworks-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Industry Frameworks and Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cryptography-and-certificate-management" class="md-nav__link">
    <span class="md-ellipsis">
      Cryptography and Certificate Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-tools-and-platforms" class="md-nav__link">
    <span class="md-ellipsis">
      Automation Tools and Platforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-and-configuration-management" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Configuration Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incident-response-and-operational-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response and Operational Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-studies-and-real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Case Studies and Real-World Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-research-and-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Security Research and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#books-and-comprehensive-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Books and Comprehensive Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standards-organizations-and-working-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Standards Organizations and Working Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WJXPDRF2"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <!-- Right sidebar with disclaimer above TOC -->
  
    <style>
      @media screen and (min-width: 76.25em) {
        .md-sidebar--secondary {
          order: 1;
        }
        .md-sidebar--secondary::before {
          content: '';
          display: block;
          margin-bottom: 1rem;
        }
      }
    </style>
  
  
  
                  



<h1 id="certificate-rotation-strategies">Certificate Rotation Strategies</h1>
<h2 id="why-this-matters">Why This Matters</h2>
<p><strong>For executives:</strong> Certificate rotation failures cause production outages costing $300K-$1M+ per incident. Vortex experienced certificate rotation cascading failures affecting 5-10% of requests during overlapping certificate validity windows. Rotation strategy determines whether certificate operations are smooth and invisible or disruptive and high-risk. This is operational risk management.</p>
<p><strong>For security leaders:</strong> Rotation strategy enables cryptographic agility - ability to phase out weak algorithms, respond to CA compromise, and adopt new security standards. Manual rotation means security improvements are delayed or skipped due to operational burden. Automated rotation enables rapid security response. This is security operational capability.</p>
<p><strong>For engineers:</strong> Certificate rotation is constant operational burden. Services at scale (thousands of services) rotate certificates daily or hourly. Manual rotation doesn't scale. Rotation strategy determines whether this is automated background operation or middle-of-night emergency work. This is operational sanity.</p>
<p><strong>Common scenario:</strong> Your service mesh deploys thousands of certificates with 24-hour lifespans. Rotation must happen automatically and reliably, otherwise services lose connectivity. Your rotation strategy determines whether this works smoothly or creates constant operational fires. Same applies to traditional infrastructure at smaller scale.</p>
<hr />
<h2 id="overview">Overview</h2>
<p>Certificate rotation is the planned replacement of certificates before expiry, encompassing the entire process from renewal initiation through deployment verification. Unlike emergency renewals triggered by compromise or imminent expiry, strategic rotation is a scheduled operational practice that prevents outages, reduces risk, and enables infrastructure evolution.</p>
<p><strong>Core principle</strong>: Certificate rotation should be a routine, automated operation, not an emergency response.</p>
<h2 id="why-certificate-rotation-matters">Why Certificate Rotation Matters</h2>
<h3 id="the-cost-of-reactive-renewal">The Cost of Reactive Renewal</h3>
<p>Organizations that treat certificate renewal as an ad-hoc, manual process pay steep costs:</p>
<p><strong>Operational costs</strong>:</p>
<ul>
<li>Emergency weekend work to renew expiring certificates</li>
<li>War rooms mobilized for certificate-related outages</li>
<li>Cross-team coordination overhead for every renewal</li>
<li>Testing cycles compressed under time pressure</li>
</ul>
<p><strong>Business costs</strong>:</p>
<ul>
<li>Revenue loss from certificate-related outages</li>
<li>Customer trust erosion from repeated availability issues</li>
<li>SLA violations and financial penalties</li>
<li>Opportunity cost of engineering time on manual tasks</li>
</ul>
<p><strong>Security costs</strong>:</p>
<ul>
<li>Certificates used beyond recommended lifetime</li>
<li>Weak cryptography persisting due to renewal difficulty</li>
<li>Delayed response to CA compromise</li>
<li>Reduced cryptographic agility</li>
</ul>
<h3 id="the-value-of-strategic-rotation">The Value of Strategic Rotation</h3>
<p>Proactive rotation strategies deliver:</p>
<p><strong>Predictability</strong>:</p>
<ul>
<li>Scheduled maintenance windows for certificate updates</li>
<li>Coordinated deployments across infrastructure</li>
<li>Testing integrated into normal development cycles</li>
<li>Capacity planning for CA infrastructure load</li>
</ul>
<p><strong>Automation</strong>:</p>
<ul>
<li>Reduced manual effort through tooling</li>
<li>Consistent, repeatable processes</li>
<li>Self-service capabilities for teams</li>
<li>Integration with existing deployment pipelines</li>
</ul>
<p><strong>Risk reduction</strong>:</p>
<ul>
<li>Time buffer for handling renewal failures</li>
<li>Opportunity to update cryptographic parameters</li>
<li>Gradual migration to new CAs or policies</li>
<li>Practice for emergency response scenarios</li>
</ul>
<p><strong>Compliance</strong>:</p>
<ul>
<li>Demonstrable compliance with certificate lifetime policies</li>
<li>Audit trail of rotation activities</li>
<li>Consistent application of security standards</li>
<li>Regular validation of trust chains</li>
</ul>
<h2 id="rotation-timing-strategies">Rotation Timing Strategies</h2>
<h3 id="fixed-schedule-rotation">Fixed Schedule Rotation</h3>
<p><strong>Calendar-based rotation</strong>:
Renew certificates on fixed schedule regardless of remaining validity.</p>
<p>Example policy:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">rotation_policy</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Quarterly</span><span class="nv"> </span><span class="s">Rotation&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarterly</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nt">preferred_months</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">10</span><span class="p p-Indicator">]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="nt">preferred_day</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nt">maintenance_window</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;02:00-06:00</span><span class="nv"> </span><span class="s">UTC&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nt">scope</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">production</span><span class="p p-Indicator">]</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="nt">certificate_types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">tls_server</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tls_client</span><span class="p p-Indicator">]</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">  </span><span class="nt">lead_time_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">14</span><span class="w">  </span><span class="c1"># Start rotation 14 days before scheduled date</span>
</code></pre></div></p>
<p>Advantages:</p>
<ul>
<li>Predictable change calendar</li>
<li>Coordinated with other maintenance activities</li>
<li>Enables bulk rotation efficiencies</li>
<li>Easier capacity planning for CA infrastructure</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>May renew certificates with significant remaining validity</li>
<li>Fixed schedule may conflict with business constraints</li>
<li>All certificates on same schedule creates load spikes</li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>High-security environments requiring frequent rotation</li>
<li>Environments with coordinated change windows</li>
<li>Certificates for internal services with flexible timing</li>
<li>Compliance requirements for maximum certificate age</li>
</ul>
<h3 id="validity-based-rotation">Validity-Based Rotation</h3>
<p><strong>Percentage of lifetime</strong>:
Trigger renewal when certificate reaches certain percentage of its validity period.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_renewal_trigger</span><span class="p">(</span><span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span> 
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>                              <span class="n">rotation_policy</span><span class="p">:</span> <span class="n">RotationPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="sd">    Calculate renewal trigger time based on validity percentage</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">validity_period</span> <span class="o">=</span> <span class="n">cert</span><span class="o">.</span><span class="n">not_after</span> <span class="o">-</span> <span class="n">cert</span><span class="o">.</span><span class="n">not_before</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">rotation_percentage</span> <span class="o">=</span> <span class="n">rotation_policy</span><span class="o">.</span><span class="n">rotation_threshold_percent</span> <span class="o">/</span> <span class="mi">100</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">renewal_trigger</span> <span class="o">=</span> <span class="n">cert</span><span class="o">.</span><span class="n">not_before</span> <span class="o">+</span> <span class="p">(</span><span class="n">validity_period</span> <span class="o">*</span> <span class="n">rotation_percentage</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="k">return</span> <span class="n">renewal_trigger</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1"># Example: 90-day certificate, rotate at 67% (60 days in)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="n">cert</span> <span class="o">=</span> <span class="n">Certificate</span><span class="p">(</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="n">not_before</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">not_after</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 90 days</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">policy</span> <span class="o">=</span> <span class="n">RotationPolicy</span><span class="p">(</span><span class="n">rotation_threshold_percent</span><span class="o">=</span><span class="mi">67</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="n">trigger</span> <span class="o">=</span> <span class="n">calculate_renewal_trigger</span><span class="p">(</span><span class="n">cert</span><span class="p">,</span> <span class="n">policy</span><span class="p">)</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1"># trigger = 2025-03-02 (60 days after issuance, 30 days before expiry)</span>
</code></pre></div>
<p>Common thresholds:</p>
<ul>
<li><strong>67% (2/3 lifetime)</strong>: Balanced approach, 1/3 validity remaining</li>
<li><strong>75%</strong>: More frequent rotation, 1/4 validity remaining</li>
<li><strong>80%</strong>: Aggressive rotation, 1/5 validity remaining</li>
<li><strong>50%</strong>: Conservative, half validity remaining</li>
</ul>
<p>Advantages:</p>
<ul>
<li>Distributes rotation workload over time</li>
<li>Natural staggering of renewal tasks</li>
<li>Scales with certificate validity period</li>
<li>Industry standard practice</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Less predictable timing</li>
<li>Requires per-certificate tracking</li>
<li>Complex coordination for related certificates</li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Public-facing TLS certificates</li>
<li>Automated certificate management (ACME)</li>
<li>Large-scale certificate estates</li>
<li>Default rotation strategy</li>
</ul>
<h3 id="absolute-time-window">Absolute Time Window</h3>
<p><strong>Days before expiry</strong>:
Fixed number of days before expiry regardless of initial validity.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AbsoluteTimeRotation</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days_before_expiry</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">days_before_expiry</span> <span class="o">=</span> <span class="n">days_before_expiry</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_renewal_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="sd">        Calculate renewal date as absolute days before expiry</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="k">return</span> <span class="n">cert</span><span class="o">.</span><span class="n">not_after</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">days_before_expiry</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_renewal_due</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="sd">        Check if certificate renewal is due</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        <span class="n">renewal_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_renewal_date</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">renewal_date</span>
</code></pre></div>
<p>Common windows:</p>
<ul>
<li><strong>30 days</strong>: Standard for many organizations</li>
<li><strong>45 days</strong>: Conservative buffer for complex deployments</li>
<li><strong>14 days</strong>: Minimum for production certificates</li>
<li><strong>7 days</strong>: Emergency threshold (should trigger high-priority alerts)</li>
</ul>
<p>Advantages:</p>
<ul>
<li>Simple to understand and communicate</li>
<li>Consistent buffer time for all certificates</li>
<li>Easy to align with change management processes</li>
<li>Clear escalation thresholds</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Doesn't account for certificate age</li>
<li>May result in very frequent rotations for long-lived certs</li>
<li>Fixed buffer may be too short for complex deployments</li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Simple environments with consistent certificate validity</li>
<li>Compliance requirements with specific lead time</li>
<li>Emergency rotation thresholds</li>
<li>Alert trigger points</li>
</ul>
<h3 id="event-driven-rotation">Event-Driven Rotation</h3>
<p><strong>Trigger-based rotation</strong>:
Rotate certificates in response to specific events rather than schedule.</p>
<p>Trigger events:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RotationTrigger</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="sd">    Events that can trigger certificate rotation</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="c1"># Security events</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">CA_COMPROMISE</span> <span class="o">=</span> <span class="s2">&quot;ca_compromise&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">KEY_COMPROMISE_SUSPECTED</span> <span class="o">=</span> <span class="s2">&quot;key_compromise_suspected&quot;</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="n">WEAK_CRYPTO_DEPRECATED</span> <span class="o">=</span> <span class="s2">&quot;weak_crypto_deprecated&quot;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="c1"># Operational events</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">INFRASTRUCTURE_MIGRATION</span> <span class="o">=</span> <span class="s2">&quot;infrastructure_migration&quot;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">CA_MIGRATION</span> <span class="o">=</span> <span class="s2">&quot;ca_migration&quot;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="n">POLICY_CHANGE</span> <span class="o">=</span> <span class="s2">&quot;policy_change&quot;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    <span class="c1"># Planned events</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    <span class="n">SCHEDULED_MAINTENANCE</span> <span class="o">=</span> <span class="s2">&quot;scheduled_maintenance&quot;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    <span class="n">QUARTERLY_ROTATION</span> <span class="o">=</span> <span class="s2">&quot;quarterly_rotation&quot;</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="c1"># Reactive events</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    <span class="n">VALIDATION_FAILURE</span> <span class="o">=</span> <span class="s2">&quot;validation_failure&quot;</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    <span class="n">DEPLOYMENT_ROLLBACK</span> <span class="o">=</span> <span class="s2">&quot;deployment_rollback&quot;</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">EventDrivenRotation</span><span class="p">:</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trigger</span><span class="p">:</span> <span class="n">RotationTrigger</span><span class="p">,</span> 
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>                      <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">RotationTask</span><span class="p">]:</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="sd">        Generate rotation tasks based on trigger event</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="k">if</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">RotationTrigger</span><span class="o">.</span><span class="n">CA_COMPROMISE</span><span class="p">:</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>            <span class="c1"># Rotate all certificates from compromised CA</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>            <span class="n">affected_certs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_certificates_by_issuer</span><span class="p">(</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;compromised_ca&#39;</span><span class="p">]</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>            <span class="p">)</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>                <span class="n">RotationTask</span><span class="p">(</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>                    <span class="n">certificate</span><span class="o">=</span><span class="n">cert</span><span class="p">,</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>                    <span class="n">priority</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>                    <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CA compromise: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;compromised_ca&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>                    <span class="n">target_completion</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>                <span class="p">)</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>                <span class="k">for</span> <span class="n">cert</span> <span class="ow">in</span> <span class="n">affected_certs</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>            <span class="p">]</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>        <span class="k">elif</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">RotationTrigger</span><span class="o">.</span><span class="n">WEAK_CRYPTO_DEPRECATED</span><span class="p">:</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>            <span class="c1"># Rotate certificates using deprecated crypto</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>            <span class="n">affected_certs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_certificates_by_crypto</span><span class="p">(</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;deprecated_algorithm&#39;</span><span class="p">]</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>            <span class="p">)</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>                <span class="n">RotationTask</span><span class="p">(</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>                    <span class="n">certificate</span><span class="o">=</span><span class="n">cert</span><span class="p">,</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>                    <span class="n">priority</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>                    <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Crypto deprecation: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;deprecated_algorithm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>                    <span class="n">target_completion</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>                <span class="p">)</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>                <span class="k">for</span> <span class="n">cert</span> <span class="ow">in</span> <span class="n">affected_certs</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>            <span class="p">]</span>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="k">return</span> <span class="n">tasks</span>
</code></pre></div></p>
<p>Advantages:</p>
<ul>
<li>Responsive to security requirements</li>
<li>Enables coordinated infrastructure changes</li>
<li>Forces rotation when conditions require it</li>
<li>Clear justification for rotation activity</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Unpredictable timing and load</li>
<li>May require emergency procedures</li>
<li>Coordination challenges across teams</li>
<li>Testing may be compressed</li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>CA compromise response</li>
<li>Algorithm deprecation (SHA-1, short keys)</li>
<li>Infrastructure migrations</li>
<li>Zero-day vulnerability response</li>
</ul>
<h3 id="hybrid-strategies">Hybrid Strategies</h3>
<p>Real-world rotation strategies combine multiple approaches:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">HybridRotationStrategy</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="sd">    Combine multiple rotation triggers with priority handling</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>            <span class="n">EventDrivenRotation</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>            <span class="n">AbsoluteTimeRotation</span><span class="p">(</span><span class="n">days_before_expiry</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>            <span class="n">ValidityPercentageRotation</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">67</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>            <span class="n">ScheduledRotation</span><span class="p">(</span><span class="n">schedule</span><span class="o">=</span><span class="s2">&quot;quarterly&quot;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="p">]</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RotationTask</span><span class="p">]:</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="sd">        Evaluate certificate against all strategies, return highest priority</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="n">triggered_tasks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>        <span class="k">for</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="p">:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>            <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">should_rotate</span><span class="p">(</span><span class="n">cert</span><span class="p">):</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">create_rotation_task</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>                <span class="n">triggered_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">triggered_tasks</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        <span class="c1"># Return highest priority task</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">triggered_tasks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
</code></pre></div>
<p>Example hybrid policy:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">rotation_strategy</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Production</span><span class="nv"> </span><span class="s">TLS</span><span class="nv"> </span><span class="s">Certificates&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="c1"># Primary strategy: validity-based</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">primary</span><span class="p">:</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validity_percentage</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">67</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span><span class="c1"># Emergency override: absolute time</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span><span class="nt">emergency_threshold</span><span class="p">:</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absolute_days</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="nt">days_before_expiry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="nt">escalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">  </span><span class="c1"># Coordinated rotation opportunity</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">  </span><span class="nt">scheduled_window</span><span class="p">:</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fixed_schedule</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First</span><span class="nv"> </span><span class="s">Sunday</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">quarter&quot;</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="nt">advance_renewals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Renew early if in window</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">  </span><span class="c1"># Event-driven overrides</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">  </span><span class="nt">event_triggers</span><span class="p">:</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ca_compromise</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">immediate</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">weak_crypto_deprecated</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30_days</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">policy_change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">next_maintenance_window</span>
</code></pre></div></p>
<h2 id="rotation-workflows">Rotation Workflows</h2>
<h3 id="certificate-lifecycle-states">Certificate Lifecycle States</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>   ACTIVE    
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>                  
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>                                
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>        Rotation trigger        
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>                                
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>                  
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>  PENDING                      
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>  RENEWAL                      
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>                  
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>                                
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        Renewal initiated       
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>                                
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>                  
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>   ISSUED                      
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>   (new)                       
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>                  
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>                                
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        Deployment started      
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>                                
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>                  
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a> DEPLOYING                     
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>                  
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>                                
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        Deployment verified     
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>                                
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>                  
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a> ACTIVE      
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>  (new)      
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>       
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>        Grace period
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>       
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>  RETIRED    
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>   (old)     
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
</code></pre></div>
<h3 id="end-to-end-rotation-process">End-to-End Rotation Process</h3>
<p><strong>Phase 1: Planning and Preparation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RotationPlanner</span><span class="p">:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="sd">    Plan certificate rotation with impact analysis</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plan_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationPlan</span><span class="p">:</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="sd">        Create comprehensive rotation plan</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="n">plan</span> <span class="o">=</span> <span class="n">RotationPlan</span><span class="p">(</span><span class="n">certificate</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="c1"># Impact analysis</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">affected_services</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_dependent_services</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">affected_hosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_deployment_locations</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">user_impact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_user_impact</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        <span class="c1"># Technical requirements</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">requires_load_balancer_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_lb_requirement</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">requires_config_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_config_requirements</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">requires_application_restart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_restart_requirement</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>        <span class="c1"># Timing and coordination</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">maintenance_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_maintenance_window</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">required_approvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_required_approvals</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">coordination_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_coordination_needs</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>        <span class="c1"># Rollback preparation</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">rollback_procedure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_rollback_procedure</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">health_checks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_health_checks</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>        <span class="c1"># Testing requirements</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>        <span class="n">plan</span><span class="o">.</span><span class="n">testing_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_testing_requirements</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>        <span class="k">return</span> <span class="n">plan</span>
</code></pre></div>
<p>Impact assessment:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpactAssessment</span><span class="p">:</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="sd">    Assess impact of certificate rotation</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">certificate</span><span class="p">:</span> <span class="n">Certificate</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="c1"># Service impact</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="n">affected_services</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">service_criticality</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># low, medium, high, critical</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">expected_downtime</span><span class="p">:</span> <span class="n">timedelta</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="c1"># User impact</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="n">estimated_affected_users</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    <span class="n">user_facing</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="c1"># Business impact</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="n">revenue_impact</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    <span class="n">sla_risk</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    <span class="c1"># Technical complexity</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="n">deployment_locations</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    <span class="n">requires_orchestration</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    <span class="n">dependencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_risk_score</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="sd">        Calculate overall risk score for rotation</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>        <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        <span class="c1"># Service criticality</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>        <span class="n">criticality_scores</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>            <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>            <span class="s1">&#39;medium&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>        <span class="p">}</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>        <span class="n">score</span> <span class="o">+=</span> <span class="n">criticality_scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">service_criticality</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>        <span class="c1"># User impact</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_facing</span><span class="p">:</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">2.0</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimated_affected_users</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">2.0</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimated_affected_users</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>        <span class="c1"># Technical complexity</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment_locations</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_orchestration</span><span class="p">:</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>        <span class="c1"># Business impact</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sla_risk</span><span class="p">:</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">2.0</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revenue_impact</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>            <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Phase 2: Certificate Issuance</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CertificateRenewalOrchestrator</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="sd">    Orchestrate certificate renewal process</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">renew_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span> 
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>                               <span class="n">plan</span><span class="p">:</span> <span class="n">RotationPlan</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenewalResult</span><span class="p">:</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">        Execute certificate renewal with proper coordination</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">RenewalResult</span><span class="p">(</span><span class="n">original_certificate</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>            <span class="c1"># Step 1: Generate CSR</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Generating CSR&quot;</span><span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>            <span class="n">csr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_csr</span><span class="p">(</span><span class="n">cert</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>            <span class="c1"># Step 2: Submit to CA</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Submitting to CA&quot;</span><span class="p">)</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>            <span class="n">ca_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_to_ca</span><span class="p">(</span><span class="n">csr</span><span class="p">,</span> <span class="n">cert</span><span class="o">.</span><span class="n">issuing_ca</span><span class="p">)</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>            <span class="c1"># Step 3: Wait for issuance</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Waiting for issuance&quot;</span><span class="p">)</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>            <span class="n">new_cert</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_issuance</span><span class="p">(</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>                <span class="n">ca_response</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>            <span class="p">)</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>            <span class="c1"># Step 4: Validate new certificate</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Validating new certificate&quot;</span><span class="p">)</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>            <span class="n">validation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_certificate</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">validation</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>            <span class="c1"># Step 5: Store new certificate</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s2">&quot;Storing new certificate&quot;</span><span class="p">)</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_certificate</span><span class="p">(</span><span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>            <span class="n">result</span><span class="o">.</span><span class="n">new_certificate</span> <span class="o">=</span> <span class="n">new_cert</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>            <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Certificate renewal failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<p>CSR generation with continuity:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_renewal_csr</span><span class="p">(</span><span class="n">old_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span> 
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>                        <span class="n">policy</span><span class="p">:</span> <span class="n">RenewalPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CertificateRequest</span><span class="p">:</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="sd">    Generate CSR for renewal, maintaining or updating properties</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="n">csr</span> <span class="o">=</span> <span class="n">CertificateRequest</span><span class="p">()</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="c1"># Maintain subject information</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">preserve_subject</span><span class="p">:</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="n">csr</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">subject</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="n">csr</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">new_subject</span> <span class="ow">or</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">subject</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="c1"># Subject Alternative Names</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">preserve_sans</span><span class="p">:</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="n">csr</span><span class="o">.</span><span class="n">subject_alternative_names</span> <span class="o">=</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">subject_alternative_names</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        <span class="c1"># May add/remove SANs during renewal</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>        <span class="n">csr</span><span class="o">.</span><span class="n">subject_alternative_names</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>            <span class="n">policy</span><span class="o">.</span><span class="n">new_sans</span> <span class="ow">or</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">subject_alternative_names</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>        <span class="p">)</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>    <span class="c1"># Key generation</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>    <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">reuse_private_key</span><span class="p">:</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>        <span class="c1"># Reuse existing key (not recommended for routine rotation)</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>        <span class="n">csr</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">private_key</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>        <span class="c1"># Generate new key pair (recommended)</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">upgrade_crypto</span><span class="p">:</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>            <span class="c1"># Upgrade to stronger algorithm</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>            <span class="n">csr</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">generate_key</span><span class="p">(</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>                <span class="n">algorithm</span><span class="o">=</span><span class="n">policy</span><span class="o">.</span><span class="n">target_algorithm</span><span class="p">,</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>                <span class="n">key_size</span><span class="o">=</span><span class="n">policy</span><span class="o">.</span><span class="n">target_key_size</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>            <span class="p">)</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>            <span class="c1"># Same algorithm as before</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>            <span class="n">csr</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">generate_key</span><span class="p">(</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>                <span class="n">algorithm</span><span class="o">=</span><span class="n">old_cert</span><span class="o">.</span><span class="n">key_algorithm</span><span class="p">,</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>                <span class="n">key_size</span><span class="o">=</span><span class="n">old_cert</span><span class="o">.</span><span class="n">key_size</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>            <span class="p">)</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>    <span class="c1"># Extensions</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>    <span class="n">csr</span><span class="o">.</span><span class="n">extensions</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">required_extensions</span> <span class="ow">or</span> <span class="n">old_cert</span><span class="o">.</span><span class="n">extensions</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>    <span class="k">return</span> <span class="n">csr</span>
</code></pre></div></p>
<p><strong>Phase 3: Deployment</strong></p>
<p>Deployment strategies:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DeploymentStrategy</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="sd">    Different approaches to deploying renewed certificates</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">IMMEDIATE</span> <span class="o">=</span> <span class="s2">&quot;immediate&quot;</span>           <span class="c1"># Deploy immediately upon issuance</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">SCHEDULED</span> <span class="o">=</span> <span class="s2">&quot;scheduled&quot;</span>           <span class="c1"># Deploy in maintenance window</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">GRADUAL_ROLLOUT</span> <span class="o">=</span> <span class="s2">&quot;gradual&quot;</span>      <span class="c1"># Progressive deployment with validation</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">BLUE_GREEN</span> <span class="o">=</span> <span class="s2">&quot;blue_green&quot;</span>        <span class="c1"># Parallel environment deployment</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">CANARY</span> <span class="o">=</span> <span class="s2">&quot;canary&quot;</span>                <span class="c1"># Small subset first, then full deployment</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">CertificateDeploymentOrchestrator</span><span class="p">:</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="sd">    Orchestrate certificate deployment across infrastructure</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">deploy_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>                                 <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>                                 <span class="n">old_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>                                 <span class="n">strategy</span><span class="p">:</span> <span class="n">DeploymentStrategy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeploymentResult</span><span class="p">:</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="sd">        Deploy certificate using specified strategy</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">DeploymentStrategy</span><span class="o">.</span><span class="n">IMMEDIATE</span><span class="p">:</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_deployment</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">DeploymentStrategy</span><span class="o">.</span><span class="n">GRADUAL_ROLLOUT</span><span class="p">:</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradual_rollout</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">DeploymentStrategy</span><span class="o">.</span><span class="n">BLUE_GREEN</span><span class="p">:</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">blue_green_deployment</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>        <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="n">DeploymentStrategy</span><span class="o">.</span><span class="n">CANARY</span><span class="p">:</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">canary_deployment</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">)</span>
</code></pre></div>
<p>Gradual rollout implementation:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">gradual_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span> 
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>                         <span class="n">old_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeploymentResult</span><span class="p">:</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">    Gradually deploy new certificate with validation gates</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">DeploymentResult</span><span class="p">()</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">deployment_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment_targets</span><span class="p">(</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="c1"># Phase 1: Development/Test (10%)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">dev_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_by_environment</span><span class="p">(</span><span class="n">deployment_targets</span><span class="p">,</span> <span class="s1">&#39;dev&#39;</span><span class="p">)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Development deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_targets</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">dev_targets</span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_deployment</span><span class="p">(</span><span class="n">dev_targets</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_approval</span><span class="p">(</span><span class="s2">&quot;development&quot;</span><span class="p">)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    <span class="c1"># Phase 2: Staging (20%)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>    <span class="n">staging_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_by_environment</span><span class="p">(</span><span class="n">deployment_targets</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">)</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Staging deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_targets</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">staging_targets</span><span class="p">)</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_deployment</span><span class="p">(</span><span class="n">staging_targets</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_approval</span><span class="p">(</span><span class="s2">&quot;staging&quot;</span><span class="p">)</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>    <span class="c1"># Phase 3: Production canary (10% of production)</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>    <span class="n">canary_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_canary_subset</span><span class="p">(</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_by_environment</span><span class="p">(</span><span class="n">deployment_targets</span><span class="p">,</span> <span class="s1">&#39;prod&#39;</span><span class="p">),</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>        <span class="n">percentage</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    <span class="p">)</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Production canary&quot;</span><span class="p">)</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_targets</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">canary_targets</span><span class="p">)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_deployment</span><span class="p">(</span><span class="n">canary_targets</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_metrics</span><span class="p">(</span><span class="n">canary_targets</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>    <span class="c1"># Phase 4: Production rollout (remaining production)</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>    <span class="n">remaining_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_remaining_targets</span><span class="p">(</span><span class="n">deployment_targets</span><span class="p">,</span> <span class="n">canary_targets</span><span class="p">)</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Full production deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>    <span class="c1"># Deploy in batches</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_targets</span><span class="p">)</span> <span class="o">//</span> <span class="mi">5</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_batches</span><span class="p">(</span><span class="n">remaining_targets</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_targets</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_deployment</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># 5 minutes between batches</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<p>Blue-green deployment:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">blue_green_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>                               <span class="n">old_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeploymentResult</span><span class="p">:</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="sd">    Deploy to parallel environment, then switch traffic</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">DeploymentResult</span><span class="p">()</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="c1"># Identify current (blue) and target (green) environments</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="n">blue_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment_targets</span><span class="p">(</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="n">green_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parallel_environment</span><span class="p">(</span><span class="n">blue_targets</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="c1"># Step 1: Deploy to green environment</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Green environment deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_targets</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">green_targets</span><span class="p">)</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_deployment</span><span class="p">(</span><span class="n">green_targets</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="c1"># Step 2: Run health checks</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Health validation&quot;</span><span class="p">)</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    <span class="n">health_status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">comprehensive_health_check</span><span class="p">(</span><span class="n">green_targets</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">health_status</span><span class="o">.</span><span class="n">healthy</span><span class="p">:</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>        <span class="k">raise</span> <span class="n">DeploymentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Green environment unhealthy: </span><span class="si">{</span><span class="n">health_status</span><span class="o">.</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>    <span class="c1"># Step 3: Warm up green environment</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Environment warm-up&quot;</span><span class="p">)</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">warm_up_environment</span><span class="p">(</span><span class="n">green_targets</span><span class="p">)</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>    <span class="c1"># Step 4: Switch traffic to green</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Traffic cutover&quot;</span><span class="p">)</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_traffic</span><span class="p">(</span><span class="n">from_targets</span><span class="o">=</span><span class="n">blue_targets</span><span class="p">,</span> <span class="n">to_targets</span><span class="o">=</span><span class="n">green_targets</span><span class="p">)</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>    <span class="c1"># Step 5: Monitor for issues</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Post-cutover monitoring&quot;</span><span class="p">)</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_metrics</span><span class="p">(</span><span class="n">green_targets</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>    <span class="c1"># Step 6: Decommission blue environment (keep for rollback window)</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>    <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Blue environment retirement&quot;</span><span class="p">)</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">))</span>  <span class="c1"># 24-hour rollback window</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">decommission_targets</span><span class="p">(</span><span class="n">blue_targets</span><span class="p">)</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<p><strong>Phase 4: Verification</strong></p>
<p>Post-deployment validation:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DeploymentValidator</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="sd">    Validate certificate deployment success</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>                                  <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeploymentTarget</span><span class="p">],</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>                                  <span class="n">expected_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValidationResult</span><span class="p">:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="sd">        Comprehensive deployment validation</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">ValidationResult</span><span class="p">()</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>            <span class="n">target_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">expected_cert</span><span class="p">)</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_target_result</span><span class="p">(</span><span class="n">target_result</span><span class="p">)</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>                            <span class="n">target</span><span class="p">:</span> <span class="n">DeploymentTarget</span><span class="p">,</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>                            <span class="n">expected_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetValidationResult</span><span class="p">:</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="sd">        Validate certificate on specific target</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="n">validation</span> <span class="o">=</span> <span class="n">TargetValidationResult</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        <span class="c1"># Test 1: Certificate reachability</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>            <span class="n">presented_cert</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_certificate</span><span class="p">(</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>                <span class="n">target</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>                <span class="n">target</span><span class="o">.</span><span class="n">port</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>            <span class="p">)</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>            <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;reachability&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>            <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;reachability&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>            <span class="k">return</span> <span class="n">validation</span>  <span class="c1"># Can&#39;t continue if unreachable</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>        <span class="c1"># Test 2: Correct certificate deployed</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>        <span class="k">if</span> <span class="n">presented_cert</span><span class="o">.</span><span class="n">fingerprint</span> <span class="o">==</span> <span class="n">expected_cert</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">:</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>            <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;correct_certificate&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>            <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;correct_certificate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>                              <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_cert</span><span class="o">.</span><span class="n">fingerprint</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>                              <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">presented_cert</span><span class="o">.</span><span class="n">fingerprint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>        <span class="c1"># Test 3: Trust chain validation</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>        <span class="n">chain_valid</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_trust_chain</span><span class="p">(</span><span class="n">presented_cert</span><span class="p">)</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>        <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;trust_chain&quot;</span><span class="p">,</span> <span class="n">chain_valid</span><span class="p">)</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>        <span class="c1"># Test 4: Hostname match</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>        <span class="n">hostname_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_hostname_match</span><span class="p">(</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>            <span class="n">target</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>            <span class="n">presented_cert</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a>        <span class="p">)</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a>        <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;hostname_match&quot;</span><span class="p">,</span> <span class="n">hostname_match</span><span class="p">)</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a>        <span class="c1"># Test 5: Revocation status</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>        <span class="n">revocation_status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_revocation</span><span class="p">(</span><span class="n">presented_cert</span><span class="p">)</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>        <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;not_revoked&quot;</span><span class="p">,</span> 
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>                          <span class="n">revocation_status</span> <span class="o">==</span> <span class="s1">&#39;good&#39;</span><span class="p">)</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>        <span class="c1"># Test 6: TLS handshake success</span>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>        <span class="n">handshake_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_tls_handshake</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>        <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;tls_handshake&quot;</span><span class="p">,</span> <span class="n">handshake_result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>        <span class="c1"># Test 7: Application health</span>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>        <span class="n">app_health</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_application_health</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>        <span class="n">validation</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="s2">&quot;application_health&quot;</span><span class="p">,</span> <span class="n">app_health</span><span class="o">.</span><span class="n">healthy</span><span class="p">)</span>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>
<a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>        <span class="k">return</span> <span class="n">validation</span>
</code></pre></div></p>
<p>Monitoring post-deployment:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PostDeploymentMonitor</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="sd">    Monitor metrics after certificate deployment</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitor_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>                            <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeploymentTarget</span><span class="p">],</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>                            <span class="n">duration</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MonitoringResult</span><span class="p">:</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="sd">        Monitor key metrics after deployment</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MonitoringResult</span><span class="p">()</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>        <span class="k">while</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">duration</span><span class="p">:</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>            <span class="c1"># Collect metrics</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>            <span class="c1"># Error rate</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>            <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">error_rate</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">:</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_alert</span><span class="p">(</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error rate elevated: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>                <span class="p">)</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>            <span class="c1"># Latency</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>            <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">p95_latency</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">:</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_alert</span><span class="p">(</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Latency increase: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span><span class="si">}</span><span class="s2">ms&quot;</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>                <span class="p">)</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>            <span class="c1"># TLS handshake failures</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>            <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">tls_failures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_alert</span><span class="p">(</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;TLS handshake failures: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">tls_failures</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>                <span class="p">)</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>            <span class="c1"># Certificate validation errors</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>            <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">validation_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_alert</span><span class="p">(</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Certificate validation errors: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">validation_errors</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>                <span class="p">)</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># Check every minute</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<p><strong>Phase 5: Old Certificate Retirement</strong></p>
<p>Grace period management:
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CertificateRetirement</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="sd">    Manage retirement of old certificates after rotation</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grace_period</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)):</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span> <span class="o">=</span> <span class="n">grace_period</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retire_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">,</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>                                <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetirementResult</span><span class="p">:</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="sd">        Retire old certificate after grace period</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">RetirementResult</span><span class="p">(</span><span class="n">certificate</span><span class="o">=</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>        <span class="c1"># Wait for grace period</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Grace period&quot;</span><span class="p">)</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>        <span class="n">deployment_verified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>        <span class="n">grace_end</span> <span class="o">=</span> <span class="n">deployment_verified</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>        <span class="c1"># During grace period, monitor for any usage of old cert</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>        <span class="k">while</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">grace_end</span><span class="p">:</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>            <span class="n">usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_old_cert_usage</span><span class="p">(</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>            <span class="k">if</span> <span class="n">usage</span><span class="o">.</span><span class="n">in_use</span><span class="p">:</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>                    <span class="sa">f</span><span class="s2">&quot;Old certificate still in use: </span><span class="si">{</span><span class="n">usage</span><span class="o">.</span><span class="n">locations</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>                <span class="p">)</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>        <span class="c1"># After grace period, verify no usage</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Final usage check&quot;</span><span class="p">)</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>        <span class="n">final_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_old_cert_usage</span><span class="p">(</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>        <span class="k">if</span> <span class="n">final_usage</span><span class="o">.</span><span class="n">in_use</span><span class="p">:</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>            <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Certificate still in use after grace period: </span><span class="si">{</span><span class="n">final_usage</span><span class="o">.</span><span class="n">locations</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>        <span class="c1"># Archive old certificate</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Archival&quot;</span><span class="p">)</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive_certificate</span><span class="p">(</span><span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>        <span class="c1"># Update inventory</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Inventory update&quot;</span><span class="p">)</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_inventory</span><span class="p">(</span><span class="n">old_cert</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;retired&#39;</span><span class="p">)</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>        <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<h2 id="rotation-patterns-by-environment-type">Rotation Patterns by Environment Type</h2>
<h3 id="web-server-rotation">Web Server Rotation</h3>
<p><strong>Load balancer with multiple backends</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate_load_balanced_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>                                       <span class="n">service</span><span class="p">:</span> <span class="n">Service</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>                                       <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationResult</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="sd">    Rotate certificates for load-balanced web service</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">RotationResult</span><span class="p">()</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="c1"># Get all backend servers</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="n">backends</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">get_backends</span><span class="p">()</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    <span class="c1"># Deploy to backends in rolling fashion</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    <span class="k">for</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">backends</span><span class="p">:</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="c1"># Remove from load balancer pool</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">remove_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>        <span class="c1"># Deploy new certificate</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_to_target</span><span class="p">(</span><span class="n">new_cert</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>        <span class="c1"># Verify deployment</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>        <span class="n">validation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_target</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>            <span class="c1"># Rollback and stop</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollback_target</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>            <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">add_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>            <span class="n">result</span><span class="o">.</span><span class="n">failed_target</span> <span class="o">=</span> <span class="n">backend</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>        <span class="c1"># Add back to pool</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">add_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>        <span class="c1"># Wait for stability</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>    <span class="c1"># Update load balancer certificate (if applicable)</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>    <span class="k">if</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">has_certificate</span><span class="p">():</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">load_balancer</span><span class="o">.</span><span class="n">update_certificate</span><span class="p">(</span><span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<h3 id="kubernetes-rotation">Kubernetes Rotation</h3>
<p><strong>TLS secret rotation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate_kubernetes_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>                                        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>                                        <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>                                        <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationResult</span><span class="p">:</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="sd">    Rotate certificate in Kubernetes environment</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">RotationResult</span><span class="p">()</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="c1"># Create new secret with new certificate</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="n">new_secret_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">secret_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">create_secret_tls</span><span class="p">(</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        <span class="n">name</span><span class="o">=</span><span class="n">new_secret_name</span><span class="p">,</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        <span class="n">cert_pem</span><span class="o">=</span><span class="n">new_cert</span><span class="o">.</span><span class="n">pem</span><span class="p">,</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        <span class="n">key_pem</span><span class="o">=</span><span class="n">new_cert</span><span class="o">.</span><span class="n">private_key_pem</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="p">)</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="c1"># Update ingress to use new secret</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>    <span class="n">ingresses</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">find_ingresses_using_secret</span><span class="p">(</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="n">namespace</span><span class="p">,</span> <span class="n">secret_name</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="p">)</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="k">for</span> <span class="n">ingress</span> <span class="ow">in</span> <span class="n">ingresses</span><span class="p">:</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>        <span class="c1"># Update ingress spec</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">patch_ingress</span><span class="p">(</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>            <span class="n">name</span><span class="o">=</span><span class="n">ingress</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>            <span class="n">tls_secret</span><span class="o">=</span><span class="n">new_secret_name</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>        <span class="p">)</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="c1"># Wait for ingress controller to pick up change</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>        <span class="c1"># Verify</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>        <span class="n">validation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_ingress</span><span class="p">(</span><span class="n">ingress</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>            <span class="c1"># Rollback</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">patch_ingress</span><span class="p">(</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>                <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>                <span class="n">name</span><span class="o">=</span><span class="n">ingress</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>                <span class="n">tls_secret</span><span class="o">=</span><span class="n">secret_name</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>            <span class="p">)</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>    <span class="c1"># After grace period, delete old secret</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">)</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<p><strong>Certificate manager integration</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Using cert-manager for automated rotation</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-tls</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-tls-secret</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">  </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2160h</span><span class="w">  </span><span class="c1"># 90 days</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="nt">renewBefore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">720h</span><span class="w">  </span><span class="c1"># 30 days before expiry (33% of lifetime)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">  </span><span class="nt">issuerRef</span><span class="p">:</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enterprise-ca</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span><span class="nt">dnsNames</span><span class="p">:</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api.example.com</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;*.api.example.com&quot;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">  </span><span class="nt">privateKey</span><span class="p">:</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ECDSA</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">384</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="nt">rotationPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w">  </span><span class="c1"># Generate new key on renewal</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">  </span><span class="c1"># Deployment annotations for automated updates</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">  </span><span class="nt">renewalController</span><span class="p">:</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">    </span><span class="nt">restartPods</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Restart pods using the secret</span>
</code></pre></div></p>
<h3 id="api-gateway-rotation">API Gateway Rotation</h3>
<p><strong>Zero-downtime rotation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate_api_gateway_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>                                         <span class="n">gateway</span><span class="p">:</span> <span class="n">APIGateway</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>                                         <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationResult</span><span class="p">:</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="sd">    Rotate API gateway certificate without downtime</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">RotationResult</span><span class="p">()</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    <span class="c1"># Step 1: Configure dual certificate mode</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    <span class="c1"># (Many gateways support serving both certificates during transition)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">add_secondary_certificate</span><span class="p">(</span><span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    <span class="c1"># Step 2: Verify both certificates are served</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="n">primary_validation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_gateway_cert</span><span class="p">(</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="n">gateway</span><span class="p">,</span> 
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="n">gateway</span><span class="o">.</span><span class="n">primary_certificate</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>    <span class="p">)</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    <span class="n">secondary_validation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_gateway_cert</span><span class="p">(</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>        <span class="n">gateway</span><span class="p">,</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>        <span class="n">new_cert</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>    <span class="p">)</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">primary_validation</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">secondary_validation</span><span class="o">.</span><span class="n">success</span><span class="p">):</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>        <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">remove_secondary_certificate</span><span class="p">()</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>        <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>    <span class="c1"># Step 3: Monitor client connections</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>    <span class="c1"># Track which certificate clients are using</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_client_connections</span><span class="p">(</span><span class="n">gateway</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>    <span class="c1"># Step 4: Promote new certificate to primary</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>    <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">promote_secondary_to_primary</span><span class="p">()</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>    <span class="c1"># Step 5: Keep old certificate as secondary for grace period</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>    <span class="c1"># Step 6: Remove old certificate</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>    <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">remove_secondary_certificate</span><span class="p">()</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<h3 id="database-rotation">Database Rotation</h3>
<p><strong>Client certificate rotation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate_database_client_certificates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>                                              <span class="n">db_cluster</span><span class="p">:</span> <span class="n">DatabaseCluster</span><span class="p">,</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>                                              <span class="n">new_certs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Certificate</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">RotationResult</span><span class="p">:</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="sd">    Rotate client certificates for database authentication</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">RotationResult</span><span class="p">()</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>    <span class="c1"># Database client cert rotation is delicate - clients must update</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    <span class="c1"># their certificates without losing connection</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="k">for</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">new_cert</span> <span class="ow">in</span> <span class="n">new_certs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="c1"># Step 1: Add new certificate as valid for this user</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="k">await</span> <span class="n">db_cluster</span><span class="o">.</span><span class="n">add_valid_client_cert</span><span class="p">(</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>            <span class="n">user</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>            <span class="n">certificate</span><span class="o">=</span><span class="n">new_cert</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="p">)</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>        <span class="c1"># Step 2: Notify client to begin using new certificate</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_client_rotation</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">new_cert</span><span class="p">)</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>        <span class="c1"># Step 3: Monitor for successful connection with new cert</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>        <span class="n">connection_seen</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_new_cert_connection</span><span class="p">(</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>            <span class="n">db_cluster</span><span class="p">,</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>            <span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>            <span class="n">new_cert</span><span class="p">,</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>        <span class="p">)</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">connection_seen</span><span class="p">:</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>                <span class="sa">f</span><span class="s2">&quot;Client </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2"> has not connected with new certificate&quot;</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>            <span class="p">)</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>            <span class="k">continue</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>        <span class="c1"># Step 4: After grace period, remove old certificate</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>        <span class="k">await</span> <span class="n">db_cluster</span><span class="o">.</span><span class="n">remove_client_cert</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">old_cert</span><span class="p">)</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>    <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<h3 id="mobile-app-rotation">Mobile App Rotation</h3>
<p><strong>Certificate pinning update cycle</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MobileCertificateRotation</span><span class="p">:</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="sd">    Handle certificate rotation for mobile apps with certificate pinning</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="c1"># Mobile apps with cert pinning require special handling</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="c1"># Old certificate must remain valid until app updates are deployed</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate_with_pinning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>                                  <span class="n">service</span><span class="p">:</span> <span class="n">MobileAPIService</span><span class="p">,</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>                                  <span class="n">new_cert</span><span class="p">:</span> <span class="n">Certificate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationResult</span><span class="p">:</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="sd">        Rotate certificate for service with mobile app pinning</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">RotationResult</span><span class="p">()</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>        <span class="c1"># Step 1: Deploy new certificate alongside old</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">configure_dual_certificates</span><span class="p">(</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>            <span class="n">primary</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">current_certificate</span><span class="p">,</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>            <span class="n">secondary</span><span class="o">=</span><span class="n">new_cert</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>        <span class="p">)</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>        <span class="c1"># Step 2: Release app update with both pins</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;App update release&quot;</span><span class="p">)</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>        <span class="n">app_version</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_app_with_pins</span><span class="p">([</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>            <span class="n">service</span><span class="o">.</span><span class="n">current_certificate</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">,</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>            <span class="n">new_cert</span><span class="o">.</span><span class="n">fingerprint</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>        <span class="p">])</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>        <span class="c1"># Step 3: Monitor app adoption</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;App adoption monitoring&quot;</span><span class="p">)</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>        <span class="n">adoption_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>        <span class="k">while</span> <span class="n">adoption_rate</span> <span class="o">&lt;</span> <span class="mf">0.95</span><span class="p">:</span>  <span class="c1"># Wait for 95% adoption</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>            <span class="n">adoption_rate</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_app_version_adoption</span><span class="p">(</span><span class="n">app_version</span><span class="p">)</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>            <span class="c1"># Alert if adoption stalls</span>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>            <span class="k">if</span> <span class="n">adoption_rate</span> <span class="o">&lt;</span> <span class="mf">0.80</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_since_release</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="s2">&quot;App adoption below 80</span><span class="si">% a</span><span class="s2">fter 30 days&quot;</span><span class="p">)</span>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>        <span class="c1"># Step 4: Promote new certificate to primary</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Certificate promotion&quot;</span><span class="p">)</span>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">configure_dual_certificates</span><span class="p">(</span>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>            <span class="n">primary</span><span class="o">=</span><span class="n">new_cert</span><span class="p">,</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>            <span class="n">secondary</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">current_certificate</span>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>        <span class="p">)</span>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>        <span class="c1"># Step 5: Keep old certificate valid for long tail users</span>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Long tail support&quot;</span><span class="p">)</span>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">))</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>        <span class="c1"># Step 6: Remove old certificate</span>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a>        <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Old certificate removal&quot;</span><span class="p">)</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>        <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">remove_secondary_certificate</span><span class="p">()</span>
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>        <span class="c1"># Step 7: Release app version with only new pin</span>
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_app_with_pins</span><span class="p">([</span><span class="n">new_cert</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">])</span>
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a>
<a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a>        <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
<h2 id="automation-and-orchestration">Automation and Orchestration</h2>
<h3 id="acme-protocol-automated-certificate-management">ACME Protocol (Automated Certificate Management)</h3>
<p><strong>Automated renewal with ACME</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">acme</span><span class="w"> </span><span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">challenges</span><span class="p">,</span> <span class="n">messages</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">ACMERotationAutomation</span><span class="p">:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="sd">    Automated certificate rotation using ACME protocol</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acme_directory_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">account_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">ClientNetwork</span><span class="p">(</span><span class="n">acme_directory_url</span><span class="p">)</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">account_key</span> <span class="o">=</span> <span class="n">account_key</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">automated_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Certificate</span><span class="p">:</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="sd">        Fully automated certificate rotation via ACME</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>        <span class="c1"># Step 1: Create ACME client</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>        <span class="n">acme_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_acme_client</span><span class="p">()</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        <span class="c1"># Step 2: Create new order</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">acme_client</span><span class="o">.</span><span class="n">new_order</span><span class="p">(</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>            <span class="n">messages</span><span class="o">.</span><span class="n">NewOrder</span><span class="p">(</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>                <span class="n">identifiers</span><span class="o">=</span><span class="p">[</span><span class="n">messages</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>                    <span class="n">typ</span><span class="o">=</span><span class="n">messages</span><span class="o">.</span><span class="n">IDENTIFIER_FQDN</span><span class="p">,</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>                    <span class="n">value</span><span class="o">=</span><span class="n">domain</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>                <span class="p">)]</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>            <span class="p">)</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>        <span class="p">)</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>        <span class="c1"># Step 3: Complete challenges</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="k">for</span> <span class="n">authorization</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">authorizations</span><span class="p">:</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete_authorization</span><span class="p">(</span><span class="n">acme_client</span><span class="p">,</span> <span class="n">authorization</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>        <span class="c1"># Step 4: Generate CSR</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>        <span class="n">csr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_csr</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>        <span class="c1"># Step 5: Finalize order</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">acme_client</span><span class="o">.</span><span class="n">finalize_order</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">csr</span><span class="p">)</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>        <span class="c1"># Step 6: Download certificate</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>        <span class="n">certificate</span> <span class="o">=</span> <span class="n">acme_client</span><span class="o">.</span><span class="n">fetch_certificate</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>        <span class="c1"># Step 7: Deploy certificate</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_certificate</span><span class="p">(</span><span class="n">certificate</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>        <span class="c1"># Step 8: Verify deployment</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_deployment</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">certificate</span><span class="p">)</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>        <span class="k">return</span> <span class="n">certificate</span>
</code></pre></div></p>
<p><strong>Renewal scheduling</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ACMERenewalScheduler</span><span class="p">:</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="sd">    Schedule and manage ACME certificate renewals</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renewal_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.67</span><span class="p">):</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">renewal_threshold</span> <span class="o">=</span> <span class="n">renewal_threshold</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pending_renewals</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_and_schedule_renewals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="sd">        Check all certificates and schedule renewals</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>        <span class="n">certificates</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_acme_certificates</span><span class="p">()</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="k">for</span> <span class="n">cert</span> <span class="ow">in</span> <span class="n">certificates</span><span class="p">:</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_renew</span><span class="p">(</span><span class="n">cert</span><span class="p">):</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>                <span class="n">renewal_job</span> <span class="o">=</span> <span class="n">RenewalJob</span><span class="p">(</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>                    <span class="n">certificate</span><span class="o">=</span><span class="n">cert</span><span class="p">,</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>                    <span class="n">scheduled_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>                    <span class="n">priority</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_priority</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>                <span class="p">)</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pending_renewals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">renewal_job</span><span class="p">)</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>        <span class="c1"># Sort by priority</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pending_renewals</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="n">j</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_renewals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="sd">        Execute pending renewal jobs</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_renewals</span><span class="p">:</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>                <span class="n">new_cert</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">automated_rotation</span><span class="p">(</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>                    <span class="n">job</span><span class="o">.</span><span class="n">certificate</span><span class="o">.</span><span class="n">domain</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>                <span class="p">)</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>                <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;completed&#39;</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>                <span class="n">job</span><span class="o">.</span><span class="n">new_certificate</span> <span class="o">=</span> <span class="n">new_cert</span>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>                <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;failed&#39;</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>                <span class="n">job</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_renewal_failure</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="infrastructure-as-code-integration">Infrastructure as Code Integration</h3>
<p><strong>Terraform certificate rotation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Certificate resource with automated rotation</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api.example.com&quot;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="na">validation_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DNS&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="na">subject_alternative_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="s2">&quot;*.api.example.com&quot;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1">  # Create new before destroying old</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-certificate&quot;</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">    </span><span class="na">AutoRotate</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">    </span><span class="na">Rotation</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;67percent&quot;</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="p">}</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="c1"># Automated validation</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;cert_validation&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">  </span><span class="nb">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">    </span><span class="err">for</span><span class="w"> </span><span class="err">dvo</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">aws_acm_certificate.api.domain_validation_options</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">dvo.domain_name</span><span class="w"> </span><span class="p">=</span><span class="err">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">      </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_name</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">      </span><span class="na">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_value</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">      </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_type</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.name</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">  </span><span class="na">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">each.value.record</span><span class="p">]</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">  </span><span class="na">ttl</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.type</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_zone.main.zone_id</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="p">}</span>
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a><span class="c1"># Load balancer using the certificate</span>
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lb_listener&quot;</span><span class="w"> </span><span class="nv">&quot;https&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="w">  </span><span class="na">load_balancer_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lb.api.arn</span>
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="w">  </span><span class="na">port</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="w">  </span><span class="na">protocol</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS&quot;</span>
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="w">  </span><span class="na">ssl_policy</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ELBSecurityPolicy-TLS-1-2-2017-01&quot;</span>
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="w">  </span><span class="na">certificate_arn</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.api.arn</span>
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="w">  </span><span class="nb">default_action</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="w">    </span><span class="na">type</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;forward&quot;</span>
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="w">    </span><span class="na">target_group_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lb_target_group.api.arn</span>
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Ansible certificate deployment automation</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nn">---</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy renewed certificate</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web_servers</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nt">serial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Rolling deployment, one at a time</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="nt">max_fail_percentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Backup current certificate</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem.backup</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">        </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy new certificate</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">new_cert_path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reload nginx</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy new private key</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">new_key_path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/private/{{ cert_name }}.key</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reload nginx</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flush handlers</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">      </span><span class="nt">meta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Wait for nginx to stabilize</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">      </span><span class="nt">wait_for</span><span class="p">:</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify certificate deployment</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">      </span><span class="nt">uri</span><span class="p">:</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">        </span><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="w">        </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify_result</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a><span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify_result.status != 200</span>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check certificate properties</span>
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="w">      </span><span class="nt">openssl_certificate_info</span><span class="p">:</span>
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem</span>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert_info</span>
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate certificate fingerprint</span>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="w">      </span><span class="nt">assert</span><span class="p">:</span>
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a><span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert_info.fingerprints.sha256 == expected_fingerprint</span>
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a><span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Certificate</span><span class="nv"> </span><span class="s">fingerprint</span><span class="nv"> </span><span class="s">mismatch&quot;</span>
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a>
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reload nginx</span>
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a><span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>
<a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a>
<a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rollback certificate</span>
<a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a><span class="w">      </span><span class="nt">block</span><span class="p">:</span>
<a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">copy</span><span class="p">:</span>
<a id="__codelineno-26-67" name="__codelineno-26-67" href="#__codelineno-26-67"></a><span class="w">            </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem.backup</span>
<a id="__codelineno-26-68" name="__codelineno-26-68" href="#__codelineno-26-68"></a><span class="w">            </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/{{ cert_name }}.pem</span>
<a id="__codelineno-26-69" name="__codelineno-26-69" href="#__codelineno-26-69"></a><span class="w">            </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id="__codelineno-26-70" name="__codelineno-26-70" href="#__codelineno-26-70"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span>
<a id="__codelineno-26-71" name="__codelineno-26-71" href="#__codelineno-26-71"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-26-72" name="__codelineno-26-72" href="#__codelineno-26-72"></a><span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>
<a id="__codelineno-26-73" name="__codelineno-26-73" href="#__codelineno-26-73"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify_result.failed</span>
</code></pre></div></p>
<h2 id="rollback-procedures">Rollback Procedures</h2>
<h3 id="rollback-triggers">Rollback Triggers</h3>
<p>When to rollback:
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RollbackDecisionEngine</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="sd">    Determine when certificate rollback is necessary</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">should_rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>                       <span class="n">deployment</span><span class="p">:</span> <span class="n">Deployment</span><span class="p">,</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>                       <span class="n">metrics</span><span class="p">:</span> <span class="n">DeploymentMetrics</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RollbackDecision</span><span class="p">:</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="sd">        Evaluate if rollback is necessary</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>        <span class="n">decision</span> <span class="o">=</span> <span class="n">RollbackDecision</span><span class="p">()</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>        <span class="c1"># Critical: TLS handshake failures</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">tls_handshake_failure_rate</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># &gt; 1%</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="s1">&#39;critical&#39;</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;High TLS handshake failure rate&quot;</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>            <span class="k">return</span> <span class="n">decision</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>        <span class="c1"># Critical: Certificate validation errors</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">certificate_validation_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="s1">&#39;critical&#39;</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Certificate validation errors&quot;</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>            <span class="k">return</span> <span class="n">decision</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>        <span class="c1"># High: Error rate spike</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span> <span class="o">&gt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">baseline_error_rate</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">:</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error rate doubled: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>            <span class="k">return</span> <span class="n">decision</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>        <span class="c1"># High: Latency spike</span>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span> <span class="o">&gt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">baseline_p95_latency</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">:</span>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Latency increased 50%: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span><span class="si">}</span><span class="s2">ms&quot;</span>
<a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a>            <span class="k">return</span> <span class="n">decision</span>
<a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a>
<a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a>        <span class="c1"># Medium: Gradual error increase</span>
<a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a>        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span> <span class="o">&gt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">baseline_error_rate</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">:</span>
<a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">should_investigate</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a>            <span class="n">decision</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Error rate elevated but not critical&quot;</span>
<a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a>            <span class="k">return</span> <span class="n">decision</span>
<a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a>
<a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a>        <span class="c1"># All clear</span>
<a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a>        <span class="n">decision</span><span class="o">.</span><span class="n">should_rollback</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a>        <span class="k">return</span> <span class="n">decision</span>
</code></pre></div></p>
<h3 id="automated-rollback">Automated Rollback</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AutomatedRollback</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="sd">    Automated rollback for certificate deployment failures</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>                              <span class="n">deployment</span><span class="p">:</span> <span class="n">Deployment</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>                              <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RollbackResult</span><span class="p">:</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="sd">        Execute automated rollback to previous certificate</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">RollbackResult</span><span class="p">()</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>            <span class="c1"># Step 1: Log rollback initiation</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Rollback initiated&quot;</span><span class="p">)</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_rollback_event</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_stakeholders</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>            <span class="c1"># Step 2: Restore previous certificate</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Certificate restoration&quot;</span><span class="p">)</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_previous_certificate</span><span class="p">(</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>                    <span class="n">target</span><span class="p">,</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>                    <span class="n">deployment</span><span class="o">.</span><span class="n">previous_certificate</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>                <span class="p">)</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>            <span class="c1"># Step 3: Verify rollback</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Rollback verification&quot;</span><span class="p">)</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>            <span class="n">verification</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_rollback</span><span class="p">(</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>                <span class="n">targets</span><span class="p">,</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>                <span class="n">deployment</span><span class="o">.</span><span class="n">previous_certificate</span>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>            <span class="p">)</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>                <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>                <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Rollback verification failed&quot;</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>                <span class="c1"># This is a critical situation - both new and old certs failing</span>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">escalate_critical_failure</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>                <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>            <span class="c1"># Step 4: Monitor post-rollback</span>
<a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="s2">&quot;Post-rollback monitoring&quot;</span><span class="p">)</span>
<a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_metrics</span><span class="p">(</span>
<a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a>                <span class="n">targets</span><span class="p">,</span>
<a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a>                <span class="n">duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a>            <span class="p">)</span>
<a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a>
<a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics</span><span class="o">.</span><span class="n">healthy</span><span class="p">:</span>
<a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a>                <span class="n">result</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="s2">&quot;Metrics not fully recovered after rollback&quot;</span><span class="p">)</span>
<a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a>
<a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a>            <span class="c1"># Step 5: Update deployment status</span>
<a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_deployment_failed</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_rollback_successful</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span>
<a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a>
<a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a>
<a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a>            <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a>            <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">escalate_rollback_failure</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a>
<a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<h3 id="manual-rollback-procedures">Manual Rollback Procedures</h3>
<p>Runbook for manual rollback:
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="gh"># Certificate Rollback Procedure</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="gu">## When to Use</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">-</span><span class="w"> </span>Automated rollback failed
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">-</span><span class="w"> </span>Issues detected after grace period
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">-</span><span class="w"> </span>Certificate causing application-specific problems
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="gu">## Prerequisites</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="k">-</span><span class="w"> </span>Access to deployment targets
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="k">-</span><span class="w"> </span>Previous certificate files available
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="k">-</span><span class="w"> </span>Monitoring dashboard access
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="k">-</span><span class="w"> </span>Approval from on-call lead (for production)
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="gu">## Procedure</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="gu">### Step 1: Assess Situation</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="k">- [ ]</span> Confirm rollback is necessary
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="k">- [ ]</span> Identify affected services/hosts
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="k">- [ ]</span> Locate previous certificate files
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="k">- [ ]</span> Check for any dependencies
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="gu">### Step 2: Prepare</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="k">- [ ]</span> Notify stakeholders of rollback
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="k">- [ ]</span> Create rollback ticket: [TICKET]
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="k">- [ ]</span> Start incident bridge if critical
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="k">- [ ]</span> Have backup contact ready
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="gu">### Step 3: Execute Rollback</span>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a>For each affected target:
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="k">1.</span> Backup current (failing) certificate:
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="sb">   ```bash</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">   </span>cp<span class="w"> </span>/etc/ssl/certs/service.pem<span class="w"> </span>/etc/ssl/certs/service.pem.failed
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">   </span>cp<span class="w"> </span>/etc/ssl/private/service.key<span class="w"> </span>/etc/ssl/private/service.key.failed
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="sb">   ```</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="k">2.</span> Restore previous certificate:
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a><span class="sb">   ```bash</span>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a><span class="w">   </span>cp<span class="w"> </span>/etc/ssl/certs/service.pem.backup<span class="w"> </span>/etc/ssl/certs/service.pem
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a><span class="w">   </span>cp<span class="w"> </span>/etc/ssl/private/service.key.backup<span class="w"> </span>/etc/ssl/private/service.key
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a><span class="sb">   ```</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="k">3.</span> Restart service:
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a><span class="sb">   ```bash</span>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a><span class="w">   </span>systemctl<span class="w"> </span>reload<span class="w"> </span>nginx<span class="w">  </span><span class="c1"># or appropriate service</span>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a><span class="sb">   ```</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a><span class="k">4.</span> Verify:
<a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a><span class="sb">   ```bash</span>
<a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a><span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>localhost:443<span class="w"> </span>-servername<span class="w"> </span>service.example.com<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-fingerprint
<a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a><span class="w">   </span><span class="c1"># Should match previous certificate fingerprint: AA:BB:CC:...</span>
<a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a><span class="sb">   ```</span>
<a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a>
<a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a><span class="gu">### Step 4: Verify</span>
<a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a>
<a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a><span class="k">- [ ]</span> All targets reverted to previous certificate
<a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a><span class="k">- [ ]</span> TLS handshakes succeeding
<a id="__codelineno-29-62" name="__codelineno-29-62" href="#__codelineno-29-62"></a><span class="k">- [ ]</span> Application health checks passing
<a id="__codelineno-29-63" name="__codelineno-29-63" href="#__codelineno-29-63"></a><span class="k">- [ ]</span> Error rates returned to normal
<a id="__codelineno-29-64" name="__codelineno-29-64" href="#__codelineno-29-64"></a><span class="k">- [ ]</span> No certificate validation errors
<a id="__codelineno-29-65" name="__codelineno-29-65" href="#__codelineno-29-65"></a>
<a id="__codelineno-29-66" name="__codelineno-29-66" href="#__codelineno-29-66"></a><span class="gu">### Step 5: Monitor</span>
<a id="__codelineno-29-67" name="__codelineno-29-67" href="#__codelineno-29-67"></a>
<a id="__codelineno-29-68" name="__codelineno-29-68" href="#__codelineno-29-68"></a><span class="k">- [ ]</span> Monitor for 30 minutes post-rollback
<a id="__codelineno-29-69" name="__codelineno-29-69" href="#__codelineno-29-69"></a><span class="k">- [ ]</span> Check dashboard: [DASHBOARD_URL]
<a id="__codelineno-29-70" name="__codelineno-29-70" href="#__codelineno-29-70"></a><span class="k">- [ ]</span> Verify no new alerts
<a id="__codelineno-29-71" name="__codelineno-29-71" href="#__codelineno-29-71"></a><span class="k">- [ ]</span> Confirm customer impact resolved
<a id="__codelineno-29-72" name="__codelineno-29-72" href="#__codelineno-29-72"></a>
<a id="__codelineno-29-73" name="__codelineno-29-73" href="#__codelineno-29-73"></a><span class="gu">### Step 6: Post-Rollback</span>
<a id="__codelineno-29-74" name="__codelineno-29-74" href="#__codelineno-29-74"></a>
<a id="__codelineno-29-75" name="__codelineno-29-75" href="#__codelineno-29-75"></a><span class="k">- [ ]</span> Update incident ticket
<a id="__codelineno-29-76" name="__codelineno-29-76" href="#__codelineno-29-76"></a><span class="k">- [ ]</span> Notify stakeholders of completion
<a id="__codelineno-29-77" name="__codelineno-29-77" href="#__codelineno-29-77"></a><span class="k">- [ ]</span> Schedule post-mortem
<a id="__codelineno-29-78" name="__codelineno-29-78" href="#__codelineno-29-78"></a><span class="k">- [ ]</span> Document failure cause
<a id="__codelineno-29-79" name="__codelineno-29-79" href="#__codelineno-29-79"></a><span class="k">- [ ]</span> Plan remediation approach
<a id="__codelineno-29-80" name="__codelineno-29-80" href="#__codelineno-29-80"></a>
<a id="__codelineno-29-81" name="__codelineno-29-81" href="#__codelineno-29-81"></a><span class="gu">## Escalation</span>
<a id="__codelineno-29-82" name="__codelineno-29-82" href="#__codelineno-29-82"></a>If rollback doesn&#39;t resolve issues:
<a id="__codelineno-29-83" name="__codelineno-29-83" href="#__codelineno-29-83"></a>
<a id="__codelineno-29-84" name="__codelineno-29-84" href="#__codelineno-29-84"></a><span class="k">1.</span> Page: platform-lead
<a id="__codelineno-29-85" name="__codelineno-29-85" href="#__codelineno-29-85"></a><span class="k">2.</span> Escalate to: director-infrastructure
<a id="__codelineno-29-86" name="__codelineno-29-86" href="#__codelineno-29-86"></a><span class="k">3.</span> Emergency contact: [PHONE]
<a id="__codelineno-29-87" name="__codelineno-29-87" href="#__codelineno-29-87"></a>
<a id="__codelineno-29-88" name="__codelineno-29-88" href="#__codelineno-29-88"></a><span class="gu">## Rollback Contacts</span>
<a id="__codelineno-29-89" name="__codelineno-29-89" href="#__codelineno-29-89"></a>
<a id="__codelineno-29-90" name="__codelineno-29-90" href="#__codelineno-29-90"></a><span class="k">-</span><span class="w"> </span>Primary: platform-team Slack channel
<a id="__codelineno-29-91" name="__codelineno-29-91" href="#__codelineno-29-91"></a><span class="k">-</span><span class="w"> </span>On-call: [PAGERDUTY_LINK]
<a id="__codelineno-29-92" name="__codelineno-29-92" href="#__codelineno-29-92"></a><span class="k">-</span><span class="w"> </span>Emergency: [PHONE]
</code></pre></div></p>
<h2 id="best-practices">Best Practices</h2>
<h3 id="dos">Do's</h3>
<p><strong>Planning and preparation</strong>:</p>
<ul>
<li>Plan rotations well in advance (60-90 days for complex services)</li>
<li>Understand dependencies before rotating</li>
<li>Test rotation procedures in non-production first</li>
<li>Have rollback procedures ready before starting</li>
<li>Coordinate with other planned maintenance</li>
</ul>
<p><strong>Automation</strong>:</p>
<ul>
<li>Automate repetitive rotation tasks</li>
<li>Use ACME for public certificates where possible</li>
<li>Integrate rotation with CI/CD pipelines</li>
<li>Implement automatic verification</li>
<li>Enable self-service for development certificates</li>
</ul>
<p><strong>Communication</strong>:</p>
<ul>
<li>Notify stakeholders of upcoming rotations</li>
<li>Provide clear timelines and expectations</li>
<li>Keep status updated during rotation</li>
<li>Document lessons learned</li>
<li>Maintain runbooks and procedures</li>
</ul>
<p><strong>Verification</strong>:</p>
<ul>
<li>Always verify deployments</li>
<li>Monitor metrics post-deployment</li>
<li>Test rollback procedures regularly</li>
<li>Validate trust chains</li>
<li>Check for application-specific issues</li>
</ul>
<h3 id="donts">Don'ts</h3>
<p><strong>Timing</strong>:</p>
<ul>
<li>Don't rotate during high-traffic periods</li>
<li>Don't combine with other major changes</li>
<li>Don't rotate on Friday afternoons (unless automated with monitoring)</li>
<li>Don't rush rotations under time pressure</li>
<li>Don't skip testing phases</li>
</ul>
<p><strong>Process</strong>:</p>
<ul>
<li>Don't skip impact assessment</li>
<li>Don't deploy to all targets simultaneously</li>
<li>Don't ignore validation failures</li>
<li>Don't disable monitoring during rotation</li>
<li>Don't assume success without verification</li>
</ul>
<p><strong>Risk management</strong>:</p>
<ul>
<li>Don't rotate certificates with &lt; 7 days until expiry (too risky)</li>
<li>Don't reuse private keys across rotations</li>
<li>Don't skip rollback planning</li>
<li>Don't ignore warnings from validation</li>
<li>Don't rotate without backups</li>
</ul>
<h2 id="common-challenges-and-solutions">Common Challenges and Solutions</h2>
<h3 id="challenge-coordinating-multi-system-rotation">Challenge: Coordinating Multi-System Rotation</h3>
<p><strong>Problem</strong>: Certificate used across multiple systems that must stay synchronized.</p>
<p><strong>Solution</strong>:</p>
<ul>
<li>Use configuration management for atomic updates</li>
<li>Implement leader-follower deployment pattern</li>
<li>Deploy to canary subset first</li>
<li>Maintain compatibility period with dual certificate support</li>
<li>Use infrastructure-as-code for coordination</li>
</ul>
<h3 id="challenge-long-running-connections">Challenge: Long-Running Connections</h3>
<p><strong>Problem</strong>: Existing connections don't pick up new certificate.</p>
<p><strong>Solution</strong>:</p>
<ul>
<li>Plan for connection drain periods</li>
<li>Implement graceful connection termination</li>
<li>Use dual certificate mode during transition</li>
<li>Monitor for lingering old connections</li>
<li>Force reconnection for critical updates only</li>
</ul>
<h3 id="challenge-third-party-dependencies">Challenge: Third-Party Dependencies</h3>
<p><strong>Problem</strong>: External systems or partners need notice of certificate changes.</p>
<p><strong>Solution</strong>:</p>
<ul>
<li>Provide advance notice (30+ days)</li>
<li>Publish certificate information to known endpoint</li>
<li>Maintain overlap period with both certificates</li>
<li>Provide clear documentation and support contacts</li>
<li>Monitor for errors from partner systems</li>
</ul>
<h3 id="challenge-certificate-pinning">Challenge: Certificate Pinning</h3>
<p><strong>Problem</strong>: Mobile apps or clients with certificate pinning can't adapt quickly.</p>
<p><strong>Solution</strong>:</p>
<ul>
<li>Plan 90+ day rotation cycles</li>
<li>Include both old and new pins in app updates</li>
<li>Deploy new certificate while old is still valid</li>
<li>Monitor app version adoption before removing old certificate</li>
<li>Maintain backup pinning mechanism</li>
</ul>
<h2 id="measuring-rotation-success">Measuring Rotation Success</h2>
<h3 id="key-metrics">Key Metrics</h3>
<p><strong>Rotation efficiency</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">RotationMetrics</span><span class="p">:</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="sd">    Metrics for measuring rotation program effectiveness</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="c1"># Timing</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="n">average_rotation_duration</span><span class="p">:</span> <span class="n">timedelta</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="n">rotation_lead_time</span><span class="p">:</span> <span class="n">timedelta</span>  <span class="c1"># Time from trigger to completion</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="c1"># Success rates</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>    <span class="n">rotation_success_rate</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Percentage successful first attempt</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>    <span class="n">rollback_rate</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Percentage requiring rollback</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>    <span class="c1"># Automation</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>    <span class="n">automated_rotation_percentage</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="n">manual_intervention_required</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>    <span class="c1"># Impact</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>    <span class="n">rotation_caused_incidents</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>    <span class="n">rotation_caused_downtime</span><span class="p">:</span> <span class="n">timedelta</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="n">mean_time_to_rotate</span><span class="p">:</span> <span class="n">timedelta</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    <span class="c1"># Coverage</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>    <span class="n">certificates_rotated_on_schedule</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Percentage</span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>    <span class="n">certificates_rotated_late</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>    <span class="n">emergency_rotations</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_rotation_score</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="sd">        Calculate overall rotation program health score</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>        <span class="n">score</span> <span class="o">=</span> <span class="mf">100.0</span>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a>        <span class="c1"># Deduct for failures</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>        <span class="n">score</span> <span class="o">-=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_success_rate</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>        <span class="n">score</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollback_rate</span> <span class="o">*</span> <span class="mi">20</span>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a>
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>        <span class="c1"># Deduct for incidents</span>
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>        <span class="n">score</span> <span class="o">-=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_caused_incidents</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>        <span class="c1"># Bonus for automation</span>
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a>        <span class="n">score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">automated_rotation_percentage</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a>
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a>        <span class="c1"># Deduct for late rotations</span>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a>        <span class="n">late_percentage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">certificates_rotated_late</span> <span class="o">/</span> <span class="n">total_certificates</span>
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a>        <span class="n">score</span> <span class="o">-=</span> <span class="n">late_percentage</span> <span class="o">*</span> <span class="mi">15</span>
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a>
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="continuous-improvement">Continuous Improvement</h3>
<p><strong>Post-rotation reviews</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RotationPostMortem</span><span class="p">:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="sd">    Structured post-rotation review</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_review</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="n">Rotation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RotationReview</span><span class="p">:</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="sd">        Generate post-rotation review</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>        <span class="n">review</span> <span class="o">=</span> <span class="n">RotationReview</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>        <span class="c1"># What went well</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>        <span class="n">review</span><span class="o">.</span><span class="n">successes</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>            <span class="s2">&quot;Automated renewal completed without intervention&quot;</span><span class="p">,</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>            <span class="s2">&quot;Zero customer impact during rotation&quot;</span><span class="p">,</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>            <span class="s2">&quot;Completed 2 days ahead of schedule&quot;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>        <span class="p">]</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>        <span class="c1"># What could be improved</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>        <span class="n">review</span><span class="o">.</span><span class="n">improvements</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>            <span class="s2">&quot;Deploy to canary before full rollout&quot;</span><span class="p">,</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>            <span class="s2">&quot;Add automated verification step&quot;</span><span class="p">,</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>            <span class="s2">&quot;Improve monitoring alert thresholds&quot;</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>        <span class="p">]</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>        <span class="c1"># Action items</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>        <span class="n">review</span><span class="o">.</span><span class="n">action_items</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>            <span class="n">ActionItem</span><span class="p">(</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Implement canary deployment automation&quot;</span><span class="p">,</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>                <span class="n">owner</span><span class="o">=</span><span class="s2">&quot;platform-team&quot;</span><span class="p">,</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>                <span class="n">due_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>            <span class="p">),</span>
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>            <span class="n">ActionItem</span><span class="p">(</span>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Update runbook with lessons learned&quot;</span><span class="p">,</span>
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>                <span class="n">owner</span><span class="o">=</span><span class="s2">&quot;sre-team&quot;</span><span class="p">,</span>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>                <span class="n">due_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a>            <span class="p">)</span>
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>        <span class="p">]</span>
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a>
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a>        <span class="k">return</span> <span class="n">review</span>
</code></pre></div></p>
<h2 id="conclusion">Conclusion</h2>
<p>Certificate rotation is a critical operational capability that should be treated as a core infrastructure competency, not an afterthought. Organizations that invest in strategic rotation approaches, comprehensive automation, and robust rollback procedures transform certificate management from a source of anxiety and outages into a routine, predictable operation.</p>
<p>The path forward is clear: start with manual but well-documented procedures, progressively automate common patterns, integrate with existing deployment pipelines, and continuously refine based on operational experience. The goal is not perfect automation on day one, but steady improvement toward a state where certificate rotation is invisible, reliable, and never the cause of an outage.</p>
<p>Remember: the best rotations are the ones no one notices because they happen automatically, correctly, and without incident.</p>
<h2 id="references">References</h2>
<h3 id="standards-and-specifications">Standards and Specifications</h3>
<ol>
<li>
<p><strong>RFC 8555 - Automatic Certificate Management Environment (ACME)</strong><br />
<a href="https://datatracker.ietf.org/doc/html/rfc8555">Ietf - Rfc8555</a><br />
   IETF standard for automated certificate issuance and renewal</p>
</li>
<li>
<p><strong>RFC 5280 - Internet X.509 Public Key Infrastructure Certificate and CRL Profile</strong><br />
<a href="https://datatracker.ietf.org/doc/html/rfc5280">Ietf - Rfc5280</a><br />
   Defines certificate validity periods and lifecycle management</p>
</li>
<li>
<p><strong>RFC 6960 - X.509 Internet Public Key Infrastructure Online Certificate Status Protocol (OCSP)</strong><br />
<a href="https://datatracker.ietf.org/doc/html/rfc6960">Ietf - Rfc6960</a><br />
   Certificate revocation checking during rotation</p>
</li>
<li>
<p><strong>CA/Browser Forum Baseline Requirements</strong><br />
<a href="https://cabforum.org/baseline-requirements-documents/">Cabforum - Baseline Requirements Documents</a><br />
   Industry standards for certificate lifetimes and issuance practices</p>
</li>
<li>
<p><strong>NIST SP 800-57 Part 1 Rev. 5 - Recommendation for Key Management</strong><br />
<a href="https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final">Nist - Detail</a><br />
   Guidelines for cryptographic key and certificate lifecycle management</p>
</li>
</ol>
<h3 id="industry-frameworks-and-best-practices">Industry Frameworks and Best Practices</h3>
<ol>
<li>
<p><strong>NIST Cybersecurity Framework v1.1</strong><br />
<a href="https://www.nist.gov/cyberframework">Nist - Cyberframework</a><br />
   Framework including asset management and protective technology</p>
</li>
<li>
<p><strong>CIS Controls v8</strong><br />
<a href="https://www.cisecurity.org/controls/v8">Cisecurity - Controls</a><br />
   Control 4.1 covers secure configuration management including certificates</p>
</li>
<li>
<p><strong>ISO/IEC 27001:2022 Annex A.8 - Asset Management</strong><br />
<a href="https://www.iso.org/standard/27001">Iso - Standard</a><br />
   Information security controls for certificate lifecycle management</p>
</li>
<li>
<p><strong>PCI DSS v4.0 Requirements 4.2 and 6.3</strong><br />
<a href="https://www.pcisecuritystandards.org/">Pcisecuritystandards</a><br />
   Requirements for certificate management in payment card environments</p>
</li>
<li>
<p><strong>SOC 2 Trust Services Criteria - Availability (A1.2)</strong><br />
<a href="https://www.aicpa.org/soc4so">Aicpa - Soc4So</a><br />
    Audit criteria for system availability including certificate rotation</p>
</li>
</ol>
<h3 id="cryptography-and-certificate-management">Cryptography and Certificate Management</h3>
<ol>
<li>
<p><strong>Barnes, R., et al. "Automatic Certificate Management Environment (ACME)"</strong> (2019)<br />
    RFC 8555 technical specification and implementation guidance</p>
</li>
<li>
<p><strong>Cooper, D., et al. "Internet X.509 Public Key Infrastructure Certificate Policy and Certification Practices Framework"</strong> (2008)<br />
    RFC 5280 - Foundation for certificate lifecycle policies</p>
</li>
<li>
<p><strong>Housley, R. "Cryptographic Message Syntax (CMS)"</strong> (2009)<br />
    RFC 5652 - Certificate packaging and transport formats</p>
</li>
<li>
<p><strong>Aas, J., et al. "Let's Encrypt: An Automated Certificate Authority to Encrypt the Entire Web"</strong> (2019)<br />
    CCS '19 Conference - Large-scale automated certificate rotation practices</p>
</li>
<li>
<p><strong>Durumeric, Z., et al. "Analysis of the HTTPS Certificate Ecosystem"</strong> (2013)<br />
    IMC '13 - Academic study of certificate deployment and rotation patterns</p>
</li>
</ol>
<h3 id="automation-tools-and-platforms">Automation Tools and Platforms</h3>
<ol>
<li>
<p><strong>cert-manager Documentation</strong><br />
<a href="https://cert-manager.io/docs/">Cert-manager</a><br />
    Kubernetes-native certificate management and automation</p>
</li>
<li>
<p><strong>HashiCorp Vault PKI Secrets Engine</strong><br />
<a href="https://developer.hashicorp.com/vault/docs/secrets/pki">Hashicorp - Secrets</a><br />
    Dynamic certificate generation and rotation automation</p>
</li>
<li>
<p><strong>AWS Certificate Manager User Guide</strong><br />
<a href="https://docs.aws.amazon.com/acm/">Amazon - Acm</a><br />
    Managed certificate rotation in AWS environments</p>
</li>
<li>
<p><strong>Azure Key Vault Certificates</strong><br />
<a href="https://learn.microsoft.com/azure/key-vault/certificates/">Microsoft - Key Vault</a><br />
    Certificate lifecycle management in Azure</p>
</li>
<li>
<p><strong>Google Certificate Authority Service</strong><br />
<a href="https://cloud.google.com/certificate-authority-service/docs">Google - Certificate Authority Service</a><br />
    GCP managed private CA with automated rotation</p>
</li>
</ol>
<h3 id="deployment-and-configuration-management">Deployment and Configuration Management</h3>
<ol>
<li>
<p><strong>Ansible Automation Platform - crypto Modules</strong><br />
<a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/">Ansible - Latest</a><br />
    Infrastructure-as-code for certificate deployment</p>
</li>
<li>
<p><strong>Terraform AWS ACM Provider</strong><br />
<a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/acm_certificate">Terraform - Hashicorp</a><br />
    Certificate lifecycle management with infrastructure-as-code</p>
</li>
<li>
<p><strong>Kubernetes Ingress TLS Configuration</strong><br />
<a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#tls">Kubernetes - Services Networking</a><br />
    Certificate deployment in container orchestration</p>
</li>
<li>
<p><strong>NGINX SSL Module Documentation</strong><br />
<a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html">Nginx - Ngx Http Ssl Module.Html</a><br />
    Web server certificate configuration and hot-reload</p>
</li>
<li>
<p><strong>HAProxy SSL/TLS Configuration</strong><br />
<a href="https://www.haproxy.com/documentation/haproxy-configuration-manual/latest/#5.1-crt">Haproxy - Haproxy Configuration Manual</a><br />
    Load balancer certificate management and zero-downtime rotation</p>
</li>
</ol>
<h3 id="incident-response-and-operational-practices">Incident Response and Operational Practices</h3>
<ol>
<li>
<p><strong>Google SRE Book - Chapter 12: Effective Troubleshooting</strong><br />
<a href="https://sre.google/sre-book/effective-troubleshooting/">Sre - Effective Troubleshooting</a><br />
    Systematic approach to incident response including certificate issues</p>
</li>
<li>
<p><strong>PagerDuty Incident Response Guide</strong><br />
<a href="https://response.pagerduty.com/">Pagerduty</a><br />
    Escalation and communication patterns for certificate incidents</p>
</li>
<li>
<p><strong>Atlassian Incident Management Handbook</strong><br />
<a href="https://www.atlassian.com/incident-management">Atlassian - Incident Management</a><br />
    Runbook development and incident coordination</p>
</li>
<li>
<p><strong>SANS Institute - Incident Handler's Handbook</strong><br />
<a href="https://www.sans.org/white-papers/33901/">Sans - White Papers</a><br />
    Security incident response including certificate compromise</p>
</li>
<li>
<p><strong>ITIL 4: Change Management</strong><br />
<a href="https://www.axelos.com/certifications/itil-service-management">Axelos - Itil Service Management</a><br />
    Change control framework for certificate rotation activities</p>
</li>
</ol>
<h3 id="case-studies-and-real-world-examples">Case Studies and Real-World Examples</h3>
<ol>
<li>
<p><strong>Ponemon Institute: Cost of a Data Breach Report 2024</strong><br />
<a href="https://www.ibm.com/security/data-breach">Ibm - Data Breach</a><br />
    Includes cost analysis of certificate-related outages</p>
</li>
<li>
<p><strong>Let's Encrypt Statistics</strong><br />
<a href="https://letsencrypt.org/stats/">Letsencrypt - Stats</a><br />
    Real-world data on automated certificate rotation at massive scale</p>
</li>
<li>
<p><strong>Netcraft SSL Survey</strong><br />
<a href="https://www.netcraft.com/internet-data-mining/ssl-survey/">Netcraft - Ssl Survey</a><br />
    Industry trends in certificate deployment and rotation</p>
</li>
<li>
<p><strong>Certificate Transparency Logs</strong><br />
<a href="https://certificate.transparency.dev/">Transparency</a><br />
    Observable patterns in certificate issuance and rotation timing</p>
</li>
<li>
<p><strong>Qualys SSL Labs Reports</strong><br />
<a href="https://www.ssllabs.com/ssl-pulse/">Ssllabs - Ssl Pulse</a><br />
    Global SSL/TLS deployment practices and rotation patterns</p>
</li>
</ol>
<h3 id="monitoring-and-observability">Monitoring and Observability</h3>
<ol>
<li>
<p><strong>Prometheus Certificate Exporter</strong><br />
<a href="https://github.com/enix/x509-certificate-exporter">Github - X509 Certificate Exporter</a><br />
    Open-source tool for certificate monitoring and metrics</p>
</li>
<li>
<p><strong>Grafana Dashboard Examples for Certificates</strong><br />
<a href="https://grafana.com/grafana/dashboards/?search=certificate">Grafana - Dashboards</a><br />
    Visualization templates for certificate rotation metrics</p>
</li>
<li>
<p><strong>OpenTelemetry Collector</strong><br />
<a href="https://opentelemetry.io/docs/collector/">Opentelemetry - Collector</a><br />
    Observability framework for certificate lifecycle events</p>
</li>
<li>
<p><strong>Datadog TLS Certificate Monitoring</strong><br />
<a href="https://docs.datadoghq.com/monitors/types/ssl/">Datadoghq - Types</a><br />
    Commercial monitoring solution for certificate rotation</p>
</li>
<li>
<p><strong>New Relic Synthetic Monitoring</strong><br />
<a href="https://docs.newrelic.com/docs/synthetics/">Newrelic - Synthetics</a><br />
    Active monitoring for certificate validation and rotation verification</p>
</li>
</ol>
<h3 id="security-research-and-analysis">Security Research and Analysis</h3>
<ol>
<li>
<p><strong>Heartbleed Bug (CVE-2014-0160)</strong><br />
<a href="https://heartbleed.com/">Heartbleed</a><br />
    Critical vulnerability demonstrating importance of cryptographic rotation</p>
</li>
<li>
<p><strong>Cloudflare Post-Quantum Cryptography</strong><br />
<a href="https://blog.cloudflare.com/post-quantum-for-all/">Cloudflare - Post Quantum For All</a><br />
    Future of certificate rotation with new cryptographic algorithms</p>
</li>
<li>
<p><strong>NIST Post-Quantum Cryptography Standardization</strong><br />
<a href="https://csrc.nist.gov/projects/post-quantum-cryptography">Nist - Post Quantum Cryptography</a><br />
    Preparing for quantum-safe certificate rotation</p>
</li>
<li>
<p><strong>Mozilla Observatory</strong><br />
<a href="https://observatory.mozilla.org/">Mozilla</a><br />
    Security scanning including certificate configuration assessment</p>
</li>
<li>
<p><strong>SSLMate Certificate Search</strong><br />
<a href="https://sslmate.com/certspotter/">Sslmate - Certspotter</a><br />
    Certificate transparency monitoring for rotation tracking</p>
</li>
</ol>
<h3 id="books-and-comprehensive-resources">Books and Comprehensive Resources</h3>
<ol>
<li>
<p><strong>Risti, Ivan. "Bulletproof SSL and TLS"</strong> (2014)<br />
    Feisty Duck - Comprehensive guide to SSL/TLS deployment including rotation</p>
</li>
<li>
<p><strong>Viega, John and Matt Messier. "Secure Programming Cookbook"</strong> (2003)<br />
    O'Reilly - Certificate management patterns for developers</p>
</li>
<li>
<p><strong>Cvrcek, Dan. "Enterprise PKI Patterns"</strong> (2025)<br />
    Implementation patterns from Fortune 500 PKI transformations</p>
</li>
<li>
<p><strong>Ferguson, Niels, et al. "Cryptography Engineering"</strong> (2010)<br />
    Wiley - Practical cryptography including key and certificate lifecycle</p>
</li>
<li>
<p><strong>Beyer, Betsy, et al. "Site Reliability Engineering"</strong> (2016)<br />
    O'Reilly - Operational practices for reliable systems including certificates</p>
</li>
</ol>
<h3 id="standards-organizations-and-working-groups">Standards Organizations and Working Groups</h3>
<ol>
<li>
<p><strong>Internet Engineering Task Force (IETF) - ACME Working Group</strong><br />
<a href="https://datatracker.ietf.org/wg/acme/about/">Ietf - About</a><br />
    Development of automated certificate management standards</p>
</li>
<li>
<p><strong>CA/Browser Forum</strong><br />
<a href="https://cabforum.org/">Cabforum</a><br />
    Industry consortium establishing certificate issuance and management standards</p>
</li>
<li>
<p><strong>Cloud Security Alliance - PKI Working Group</strong><br />
<a href="https://cloudsecurityalliance.org/">Cloudsecurityalliance</a><br />
    Cloud-specific certificate management best practices</p>
</li>
<li>
<p><strong>Open Web Application Security Project (OWASP)</strong><br />
<a href="https://owasp.org/www-community/Transport_Layer_Protection_Cheat_Sheet">Owasp - Transport Layer Protection Cheat Sheet</a><br />
    Security guidance for TLS certificate management</p>
</li>
<li>
<p><strong>National Institute of Standards and Technology (NIST) - Cryptographic Module Validation Program</strong><br />
<a href="https://csrc.nist.gov/projects/cryptographic-module-validation-program">Nist - Cryptographic Module Validation Program</a><br />
    Standards for cryptographic implementations including certificate rotation</p>
</li>
</ol>









  




                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/axonsecurity/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
  
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var sidebar = document.querySelector('.md-sidebar--secondary .md-sidebar__scrollwrap');
      if (sidebar) {
        var disclaimer = document.createElement('div');
        disclaimer.className = 'md-sidebar-disclaimer';
        disclaimer.innerHTML = `
          <div class="md-typeset">
            <div class="admonition tip">
              <p class="admonition-title">Our Books</p>
              <p><a href="https://axonshield.com/book"><strong>The Invisible Certificate Management Tax and How Automation Eliminates 94% of It</strong></a></p>
            </div>
            <div class="admonition warning">
              <p class="admonition-title">Disclaimer</p>
              <p><small>This documentation is based on "best practices". We've observed these ignore 
                unique organizational needs and often prove ineffective for long-term, sustainable 
                operations and ignore strategic advanteges of building infrastructure intelligence.</small></p>
            </div>
          </div>
        `;
        sidebar.insertBefore(disclaimer, sidebar.firstChild);
      }
    });
  </script>
  

  </body>
</html>